<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <title data-i18n="page-title">Itinerario Familiar por Argentina</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <style>
    /* Estilos generales del cuerpo y barra superior */
    body {
      font-family: Arial, sans-serif;
      background: #f7f7f7;
      margin: 0;
      padding: 0 0 40px 0;
      color: #333;
    }
    .top-bar {
      display: flex;
      justify-content: flex-end;
      align-items: center;
      gap: 18px;
      padding: 16px 24px 0 24px;
      background: #f7f7f7;
      position: sticky;
      top: 0;
      z-index: 100;
      flex-wrap: wrap; /* Para que los botones se ajusten en pantallas peque√±as */
    }
    .top-bar span {
      font-size: 15px;
      color: #222;
    }
    .top-bar button {
      padding: 4px 12px;
      margin-left: 2px;
      border: 1px solid #bbb;
      background: #fff;
      border-radius: 4px;
      cursor: pointer;
      font-size: 15px;
    }
    .top-bar button.active {
      background: #e6eaff;
      border-color: #6d7fc9;
      font-weight: bold;
    }
    main {
      max-width: 960px;
      margin: 20px auto;
      padding: 0 15px;
    }
    h1 {
      text-align: center;
      color: #0F4761;
      margin-bottom: 10px;
    }
    .intro-text {
      text-align: center;
      margin-bottom: 30px;
      font-size: 1.1em;
      color: #555;
    }

    /* Estilos de las tarjetas de ciudad */
    .city-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
      gap: 25px;
      margin-top: 30px;
    }
    .city-card {
      background: #fff;
      border-radius: 12px;
      overflow: hidden;
      box-shadow: 0 4px 12px rgba(0,0,0,0.1);
      cursor: pointer;
      transition: transform 0.2s ease-in-out, box-shadow 0.2s ease-in-out;
      display: flex;
      flex-direction: column;
    }
    .city-card:hover {
      transform: translateY(-5px);
      box-shadow: 0 8px 20px rgba(0,0,0,0.15);
    }
    .city-card img {
      width: 100%;
      height: 180px;
      object-fit: cover;
      display: block;
      border-bottom: 1px solid #eee;
    }
    .city-card-content {
      padding: 15px;
      flex-grow: 1; /* Para que el contenido ocupe el espacio restante */
      display: flex;
      flex-direction: column;
      justify-content: space-between;
    }
    .city-card h2 {
      margin-top: 0;
      margin-bottom: 10px;
      color: #0F4761;
      font-size: 1.4em;
    }
    .city-card p {
      font-size: 0.95em;
      color: #666;
      line-height: 1.4;
      margin-bottom: 15px;
    }
    .city-card .details-link {
      display: inline-block;
      margin-top: auto; /* Empuja el enlace hacia abajo */
      color: #007BFF;
      text-decoration: none;
      font-weight: bold;
      align-self: flex-start; /* Alinea el enlace a la izquierda */
    }
    .city-card .details-link:hover {
      text-decoration: underline;
    }

    /* Estilos del Modal */
    #modal-detalle {
      display: none;
      position: fixed;
      top: 0;
      left: 0;
      width: 100vw;
      height: 100vh;
      background: rgba(0,0,0,0.6);
      z-index: 1000;
      display: flex;
      align-items: center;
      justify-content: center;
      padding: 15px; /* Padding para pantallas peque√±as */
      box-sizing: border-box; /* Incluir padding en el ancho/alto */
    }
    #modal-detalle .modal-content-wrapper {
      background: #fff;
      border-radius: 12px;
      max-width: 600px; /* Ancho m√°ximo del modal */
      width: 100%;
      padding: 25px;
      box-shadow: 0 8px 32px rgba(0,0,0,0.25);
      position: relative;
      max-height: 90vh; /* Altura m√°xima para scroll */
      overflow-y: auto; /* Scroll si el contenido es muy largo */
      box-sizing: border-box;
    }
    #modal-detalle .close-button {
      position: absolute;
      top: 10px;
      right: 15px;
      background: none;
      border: none;
      font-size: 2em;
      cursor: pointer;
      color: #555;
      line-height: 1; /* Eliminar espacio extra */
    }
    #modal-detalle .close-button:hover {
      color: #000;
    }
    #modal-detalle img.modal-main-image {
      width: 100%;
      border-radius: 10px;
      margin-bottom: 15px;
      height: 220px; /* Altura fija para la imagen principal del modal */
      object-fit: cover;
    }
    #modal-detalle h2 {
      margin-top: 0;
      color: #0F4761;
      text-align: left; /* Alineaci√≥n del t√≠tulo del modal */
      font-size: 1.8em;
      margin-bottom: 10px;
    }
    #modal-detalle h3 {
      color: #2176d2;
      margin-top: 20px;
      margin-bottom: 8px;
      font-size: 1.3em;
    }
    #modal-detalle p, #modal-detalle ul {
      font-size: 1em;
      line-height: 1.5;
      color: #444;
      margin-bottom: 10px;
    }
    #modal-detalle ul {
      padding-left: 20px;
    }
    #modal-detalle ul li {
      margin-bottom: 5px;
    }
    #modal-detalle a {
      color: #007BFF;
      text-decoration: none;
      font-weight: bold;
    }
    #modal-detalle a:hover {
      text-decoration: underline;
    }
    #modal-detalle .gallery {
      display: flex;
      gap: 10px;
      overflow-x: auto; /* Scroll horizontal para la galer√≠a */
      padding: 10px 0;
      -webkit-overflow-scrolling: touch; /* Suavizar scroll en iOS */
      scrollbar-width: thin; /* Firefox */
      scrollbar-color: #ccc #f1f1f1; /* Firefox */
    }
    #modal-detalle .gallery::-webkit-scrollbar {
      height: 8px;
    }
    #modal-detalle .gallery::-webkit-scrollbar-thumb {
      background-color: #ccc;
      border-radius: 10px;
    }
    #modal-detalle .gallery::-webkit-scrollbar-track {
      background-color: #f1f1f1;
    }
    #modal-detalle .gallery img {
      width: 150px; /* Ancho fijo para las miniaturas */
      height: 100px; /* Altura fija para las miniaturas */
      object-fit: cover;
      border-radius: 8px;
      flex-shrink: 0; /* Evita que las im√°genes se encojan */
      box-shadow: 0 2px 5px rgba(0,0,0,0.1);
    }
    #modal-detalle iframe {
      width: 100%;
      height: 200px;
      border: 1px solid #ddd;
      border-radius: 8px;
      margin-top: 15px;
    }

    /* Estilos para las secciones de IA dentro del modal */
    .ai-section {
      background: #e6f0fa;
      padding: 20px;
      border-radius: 8px;
      margin-top: 25px; /* Espacio entre secciones */
      box-shadow: 0 2px 8px rgba(0,0,0,0.1);
    }
    .ai-section h3 {
      color: #2176d2;
      margin-top: 0;
      margin-bottom: 10px;
    }
    .ai-button {
      background-color: #4CAF50; /* Green */
      color: white;
      padding: 12px 20px;
      border: none;
      border-radius: 5px;
      cursor: pointer;
      font-size: 16px;
      transition: background-color 0.3s ease;
      display: block;
      margin: 15px auto 0 auto; /* Centrar bot√≥n y espacio arriba */
      max-width: 300px;
    }
    .ai-button:hover {
      background-color: #45a049;
    }
    .ai-button:disabled {
      background-color: #cccccc;
      cursor: not-allowed;
    }
    .ai-response {
      margin-top: 20px;
      padding: 15px;
      background-color: #ffffff;
      border: 1px solid #d0e0f0;
      border-radius: 5px;
      white-space: pre-wrap; /* Para respetar saltos de l√≠nea del LLM */
      font-size: 15px;
      line-height: 1.6;
      min-height: 50px;
    }
    .ai-loading {
      text-align: center;
      font-style: italic;
      color: #666;
      margin-top: 10px;
    }


    /* Estilos RTL para hebreo */
    .rtl {
      direction: rtl !important;
      text-align: right !important;
    }
    .rtl .city-card-content, .rtl #modal-detalle h2, .rtl #modal-detalle h3, .rtl #modal-detalle p, .rtl #modal-detalle ul {
      text-align: right;
    }
    .rtl .city-card .details-link {
      align-self: flex-end; /* Alinea el enlace a la derecha en RTL */
    }
    .rtl ul {
      padding-right: 20px;
      padding-left: 0;
    }
  </style>
</head>
<body>
  <div class="top-bar">
    <span data-i18n="idioma">Idioma:</span>
    <button onclick="translatePage('es')" class="language-btn" id="btn-es">Espa√±ol</button>
    <button onclick="translatePage('he')" class="language-btn" id="btn-he">◊¢◊ë◊®◊ô◊™</button>
    <span data-i18n="moneda">Moneda:</span>
    <button id="btn-ars" onclick="cambiarMoneda('ARS')" class="currency-btn">ARS</button>
    <button id="btn-usd" onclick="cambiarMoneda('USD')" class="currency-btn">USD</button>
    <button id="btn-ils" onclick="cambiarMoneda('ILS')" class="currency-btn">ILS</button>
    </div>

  <main>
    <h1 data-i18n="main-title">Argentina: Aventura Familiar de 30 D√≠as</h1>
    <p class="intro-text" data-i18n="main-intro">
      Planifica tu viaje inolvidable por Argentina con esta gu√≠a completa.
      Descubre itinerarios, actividades, alojamientos y consejos para disfrutar en familia.
    </p>

    <div class="city-grid" id="city-grid">
      </div>

    <div class="section-container">
      <h2 data-i18n="map-page-title">Mapa Interactivo del Itinerario</h2>
      <p class="foto-caption" data-i18n="map-intro-main-page">Visualiza las principales rutas de tu viaje y consulta las distancias y tiempos estimados.</p>

      <div class="map-container">
        <img src="docs/imagenes/mapa_argentina.jpg" alt="Mapa del itinerario de Argentina" class="map-photo" onerror="this.src='https://placehold.co/800x450/cccccc/333333?text=Mapa+Itinerario'">
      </div>
      <small style="display:block; text-align:center; margin-bottom: 20px;"><a href="ciudades/mapa.html" target="_blank" id="see-bigger-map" data-i18n="see-bigger-map">Ver mapa detallado y tiempos de viaje</a></small>
    </div>

    <section style="margin-top: 40px; text-align: center; color: #777;">
      <h2 data-i18n="interactive-modules-title">M√≥dulos Interactivos</h2>
      <p data-i18n="interactive-modules-text">Conversor de moneda, lista de equipaje y consulta a IA disponibles pr√≥ximamente.</p>
    </section>

  </main>

  <div id="modal-detalle">
    <div class="modal-content-wrapper">
      <button class="close-button" onclick="cerrarModal()">√ó</button>
      <div id="contenido-modal">
        </div>
    </div>
  </div>

  <script>
    // Diccionario de traducciones espa√±ol ‚Üî hebreo
    const translations = {
      es: {
        "page-title": "Itinerario Familiar por Argentina",
        "idioma": "Idioma:",
        "moneda": "Moneda:",
        "main-title": "Argentina: Aventura Familiar de 30 D√≠as",
        "main-intro": "Planifica tu viaje inolvidable por Argentina con esta gu√≠a completa. Descubre itinerarios, actividades, alojamientos y consejos para disfrutar en familia.",
        "interactive-modules-title": "M√≥dulos Interactivos",
        "interactive-modules-text": "Conversor de moneda, lista de equipaje y consulta a IA disponibles pr√≥ximamente.",
        "map-page-title": "Mapa Interactivo del Itinerario",
        "map-intro-main-page": "Visualiza las principales rutas de tu viaje y consulta las distancias y tiempos estimados.",
        "see-bigger-map": "Ver mapa detallado y tiempos de viaje",
        "read-more": "Leer m√°s",
        "modal-activities-title": "Actividades e Itinerario",
        "modal-accommodation-title": "Alojamiento",
        "modal-restaurants-title": "Restaurantes",
        "modal-health-title": "Salud",
        "modal-transport-title": "Transporte",
        "modal-gallery-title": "Galer√≠a de Im√°genes",
        "modal-map-title": "Mapa",
        "modal-full-itinerary-link": "Ver itinerario completo de la ciudad",
        "modal-coming-soon": "Pr√≥ximamente m√°s detalles...",
        "booking-link": "Reserva en Booking",
        "airbnb-link": "Reserva en Airbnb",
        "general-tripadvisor-link": "Ver opciones en TripAdvisor",
        "general-googlemaps-link": "Ver en Google Maps",
        "general-website-link": "Visitar sitio web",
        "general-transport-link": "Ver opciones de transporte",

        // Nuevas claves de traducci√≥n para las funciones de IA
        "ai-menu-title": "Generador de Men√∫ Saludable ‚ú®",
        "ai-menu-description": "Obt√©n sugerencias de men√∫ para un d√≠a completo (desayuno, almuerzo, cena) adaptadas para dietas bajas en carbohidratos, aptas para diab√©ticos y, si es posible, sin gluten, inspiradas en la gastronom√≠a local.",
        "generate-menu-button": "Generar Men√∫",
        "ai-accommodation-title": "Sugerencias de Alojamiento con IA üè®",
        "ai-accommodation-description": "Obt√©n recomendaciones de alojamiento, considerando opciones familiares, seguras y bien ubicadas.",
        "generate-accommodation-button": "Generar Sugerencias",
        "ai-family-tips-title": "Consejos Adicionales para Familias con IA üë®‚Äçüë©‚Äçüëß‚Äçüë¶",
        "ai-family-tips-description": "Recibe consejos personalizados para disfrutar en familia, incluyendo actividades, seguridad y log√≠stica.",
        "generate-family-tips-button": "Generar Consejos",
        "ai-budget-title": "An√°lisis de Presupuesto con IA üí∞",
        "ai-budget-description": "Obt√©n un an√°lisis y desglose del presupuesto orientativo para tu estad√≠a, con posibles optimizaciones.",
        "generate-budget-button": "Analizar Presupuesto",
        "ai-loading": "Generando...",
        "ai-error": "Error al generar la respuesta. Por favor, int√©ntalo de nuevo m√°s tarde."
      },
      he: {
        "page-title": "◊ê◊®◊í◊†◊ò◊ô◊†◊î: ◊î◊®◊§◊™◊ß◊î ◊û◊©◊§◊ó◊™◊ô◊™ ◊©◊ú 30 ◊ô◊ï◊ù",
        "idioma": "◊©◊§◊î:",
        "moneda": "◊û◊ò◊ë◊¢:",
        "main-title": "◊ê◊®◊í◊†◊ò◊ô◊†◊î: ◊î◊®◊§◊™◊ß◊î ◊û◊©◊§◊ó◊™◊ô◊™ ◊©◊ú 30 ◊ô◊ï◊ù",
        "main-intro": "◊™◊õ◊†◊†◊ï ◊ê◊™ ◊î◊ò◊ô◊ï◊ú ◊î◊ë◊ú◊™◊ô ◊†◊©◊õ◊ó ◊©◊ú◊õ◊ù ◊ë◊ê◊®◊í◊†◊ò◊ô◊†◊î ◊¢◊ù ◊î◊û◊ì◊®◊ô◊ö ◊î◊û◊ú◊ê ◊î◊ñ◊î. ◊í◊ú◊ï ◊û◊°◊ú◊ï◊ú◊ô◊ù, ◊§◊¢◊ô◊ú◊ï◊ô◊ï◊™, ◊û◊ß◊ï◊û◊ï◊™ ◊ú◊ô◊†◊î ◊ï◊ò◊ô◊§◊ô◊ù ◊ú◊ë◊ô◊ú◊ï◊ô ◊û◊©◊§◊ó◊™◊ô.",
        "interactive-modules-title": "◊û◊ï◊ì◊ï◊ú◊ô◊ù ◊ê◊ô◊†◊ò◊®◊ê◊ß◊ò◊ô◊ë◊ô◊ô◊ù",
        "interactive-modules-text": "◊û◊û◊ô◊® ◊û◊ò◊ë◊¢, ◊®◊©◊ô◊û◊™ ◊¶◊ô◊ï◊ì ◊ï◊ô◊ô◊¢◊ï◊• AI ◊ô◊î◊ô◊ï ◊ñ◊û◊ô◊†◊ô◊ù ◊ë◊ß◊®◊ï◊ë.",
        "map-page-title": "◊û◊§◊™ ◊î◊û◊°◊ú◊ï◊ú ◊î◊ê◊ô◊†◊ò◊®◊ê◊ß◊ò◊ô◊ë◊ô◊™",
        "map-intro-main-page": "◊¶◊§◊ï ◊ë◊û◊°◊ú◊ï◊ú◊ô◊ù ◊î◊¢◊ô◊ß◊®◊ô◊ô◊ù ◊©◊ú ◊î◊ò◊ô◊ï◊ú ◊ï◊ë◊û◊®◊ó◊ß◊ô◊ù ◊ï◊ñ◊û◊†◊ô◊ù ◊û◊©◊ï◊¢◊®◊ô◊ù.",
        "see-bigger-map": "◊¶◊§◊ï ◊ë◊û◊§◊î ◊û◊§◊ï◊®◊ò◊™ ◊ï◊ñ◊û◊†◊ô ◊†◊°◊ô◊¢◊î",
        "read-more": "◊ß◊®◊ê ◊¢◊ï◊ì",
        "modal-activities-title": "◊§◊¢◊ô◊ú◊ï◊ô◊ï◊™ ◊ï◊û◊°◊ú◊ï◊ú",
        "modal-accommodation-title": "◊ú◊ô◊†◊î",
        "modal-restaurants-title": "◊û◊°◊¢◊ì◊ï◊™",
        "modal-health-title": "◊ë◊®◊ô◊ê◊ï◊™",
        "modal-transport-title": "◊™◊ó◊ë◊ï◊®◊î",
        "modal-gallery-title": "◊í◊ú◊®◊ô◊ô◊™ ◊™◊û◊ï◊†◊ï◊™",
        "modal-map-title": "◊û◊§◊î",
        "modal-full-itinerary-link": "◊¶◊§◊ï ◊ë◊û◊°◊ú◊ï◊ú ◊î◊û◊ú◊ê ◊©◊ú ◊î◊¢◊ô◊®",
        "modal-coming-soon": "◊§◊®◊ò◊ô◊ù ◊†◊ï◊°◊§◊ô◊ù ◊ë◊ß◊®◊ï◊ë...",
        "booking-link": "◊î◊ñ◊û◊ü ◊ë◊ë◊ï◊ß◊ô◊†◊í",
        "airbnb-link": "◊î◊ñ◊û◊ü ◊ë-Airbnb",
        "general-tripadvisor-link": "◊¶◊§◊î ◊ë◊ê◊§◊©◊®◊ï◊ô◊ï◊™ ◊ë-TripAdvisor",
        "general-googlemaps-link": "◊¶◊§◊î ◊ë◊û◊§◊ï◊™ ◊í◊ï◊í◊ú",
        "general-website-link": "◊ë◊ß◊® ◊ë◊ê◊™◊®",
        "general-transport-link": "◊¶◊§◊î ◊ë◊ê◊§◊©◊®◊ï◊ô◊ï◊™ ◊™◊ó◊ë◊ï◊®◊î",

        // Nuevas claves de traducci√≥n para las funciones de IA
        "ai-menu-title": "◊û◊ó◊ï◊ú◊ú ◊™◊§◊®◊ô◊ò ◊ë◊®◊ô◊ê ‚ú®",
        "ai-menu-description": "◊ß◊ë◊ú◊ï ◊î◊¶◊¢◊ï◊™ ◊ú◊™◊§◊®◊ô◊ò ◊ô◊ï◊û◊ô (◊ê◊®◊ï◊ó◊™ ◊ë◊ï◊ß◊®, ◊¶◊î◊®◊ô◊ô◊ù, ◊¢◊®◊ë) ◊î◊û◊ï◊™◊ê◊û◊ï◊™ ◊ú◊ì◊ô◊ê◊ò◊ï◊™ ◊ì◊ú◊ï◊™ ◊§◊ó◊û◊ô◊û◊ï◊™, ◊û◊™◊ê◊ô◊û◊ï◊™ ◊ú◊°◊ï◊õ◊®◊™◊ô◊ô◊ù, ◊ï◊ê◊ù ◊ê◊§◊©◊®, ◊ú◊ú◊ê ◊í◊ú◊ï◊ò◊ü, ◊ë◊î◊©◊®◊ê◊™ ◊î◊í◊°◊ò◊®◊ï◊†◊ï◊û◊ô◊î ◊î◊û◊ß◊ï◊û◊ô◊™.",
        "generate-menu-button": "◊¶◊ï◊® ◊™◊§◊®◊ô◊ò",
        "ai-accommodation-title": "◊î◊¶◊¢◊ï◊™ ◊ú◊ô◊†◊î ◊¢◊ù AI üè®",
        "ai-accommodation-description": "◊ß◊ë◊ú◊ï ◊î◊û◊ú◊¶◊ï◊™ ◊ú◊ô◊†◊î, ◊™◊ï◊ö ◊î◊™◊ó◊©◊ë◊ï◊™ ◊ë◊ê◊§◊©◊®◊ï◊ô◊ï◊™ ◊ô◊ì◊ô◊ì◊ï◊™◊ô◊ï◊™ ◊ú◊û◊©◊§◊ó◊ï◊™, ◊ë◊ò◊ï◊ó◊ï◊™ ◊ï◊û◊û◊ï◊ß◊û◊ï◊™ ◊î◊ô◊ò◊ë.",
        "generate-accommodation-button": "◊¶◊ï◊® ◊î◊¶◊¢◊ï◊™",
        "ai-family-tips-title": "◊ò◊ô◊§◊ô◊ù ◊†◊ï◊°◊§◊ô◊ù ◊ú◊û◊©◊§◊ó◊ï◊™ ◊¢◊ù AI üë®‚Äçüë©‚Äçüëß‚Äçüë¶",
        "ai-family-tips-description": "◊ß◊ë◊ú◊ï ◊ò◊ô◊§◊ô◊ù ◊û◊ï◊™◊ê◊û◊ô◊ù ◊ê◊ô◊©◊ô◊™ ◊ú◊ë◊ô◊ú◊ï◊ô ◊û◊©◊§◊ó◊™◊ô, ◊õ◊ï◊ú◊ú ◊§◊¢◊ô◊ú◊ï◊ô◊ï◊™, ◊ë◊ò◊ô◊ó◊ï◊™ ◊ï◊ú◊ï◊í◊ô◊°◊ò◊ô◊ß◊î.",
        "generate-family-tips-button": "◊¶◊ï◊® ◊ò◊ô◊§◊ô◊ù",
        "ai-budget-title": "◊†◊ô◊™◊ï◊ó ◊™◊ß◊¶◊ô◊ë ◊¢◊ù AI üí∞",
        "ai-budget-description": "◊ß◊ë◊ú◊ï ◊†◊ô◊™◊ï◊ó ◊ï◊§◊ô◊®◊ï◊ò ◊©◊ú ◊î◊™◊ß◊¶◊ô◊ë ◊î◊û◊©◊ï◊¢◊® ◊ú◊©◊î◊ï◊™◊õ◊ù, ◊¢◊ù ◊ê◊ï◊§◊ò◊ô◊û◊ô◊ñ◊¶◊ô◊ï◊™ ◊ê◊§◊©◊®◊ô◊ï◊™.",
        "generate-budget-button": "◊†◊™◊ó ◊™◊ß◊¶◊ô◊ë",
        "ai-loading": "◊û◊ô◊ô◊¶◊®...",
        "ai-error": "◊©◊í◊ô◊ê◊î ◊ë◊ô◊¶◊ô◊®◊™ ◊î◊™◊©◊ï◊ë◊î. ◊ê◊†◊ê ◊†◊°◊ï ◊©◊ï◊ë ◊û◊ê◊ï◊ó◊® ◊ô◊ï◊™◊®."
      }
    };

    // Tasas de cambio (se actualizan al cargar la p√°gina)
    let tasas = {
      ARS: 1,
      USD: 1000, // Valor de ejemplo, se actualizar√°
      ILS: 110   // Valor de ejemplo, se actualizar√°
    };
    // S√≠mbolos de moneda
    const simbolos = {
      ARS: "$",
      USD: "US$",
      ILS: "‚Ç™"
    };

    let idiomaActual = 'es'; // Idioma predeterminado
    let monedaActual = 'ARS'; // Moneda predeterminada

    // Lista de ciudades con sus datos clave
    const citiesData = [
      { id: "buenosaires", name: "Buenos Aires", description: "Capital vibrante de Argentina, famosa por su cultura, arquitectura y gastronom√≠a.", image: "docs/imagenes/buenosaires.jpg" },
      { id: "rosario", name: "Rosario", description: "Cuna de la bandera argentina, con una hermosa costanera y vida cultural activa.", image: "docs/imagenes/rosario.jpg" },
      { id: "bariloche", name: "Bariloche", description: "Coraz√≥n de la Patagonia andina, ideal para aventura y paisajes de ensue√±o.", image: "docs/imagenes/bariloche.jpg" },
      { id: "mendoza", name: "Mendoza", description: "Tierra del sol y del buen vino, con imponentes paisajes cordilleranos.", image: "docs/imagenes/mendoza.jpg" },
      { id: "malargue", name: "Malarg√ºe", description: "Puerta de entrada a la aventura en el sur mendocino, con formaciones geol√≥gicas √∫nicas.", image: "docs/imagenes/malargue.jpg" },
      { id: "jujuy", name: "Jujuy", description: "Provincia del norte argentino, rica en cultura andina y paisajes coloridos.", image: "docs/imagenes/jujuy.jpg" },
      { id: "iguazu", name: "Iguaz√∫", description: "Hogar de una de las maravillas naturales del mundo: las Cataratas del Iguaz√∫.", image: "docs/imagenes/iguazu.jpg" },
      { id: "corrientes", name: "Corrientes", description: "Ciudad costera con fuerte identidad cultural, cuna del chamam√© y puerta a los Esteros del Iber√°.", image: "docs/imagenes/corrientes.jpg" },
      { id: "ibera", name: "Iber√°", description: "Uno de los humedales m√°s grandes del mundo, un para√≠so de biodiversidad y ecoturismo.", image: "docs/imagenes/ibera.jpg" }
    ];

    // Funci√≥n para obtener tasas de cambio reales desde ExchangeRate-API
    function actualizarTasas(callback) {
      fetch('https://open.er-api.com/v6/latest/USD')
        .then(response => response.json())
        .then(data => {
          if (data && data.result === "success") {
            tasas.ARS = data.rates.ARS;
            tasas.USD = 1; // USD es la base
            tasas.ILS = data.rates.ILS;
          }
          if (typeof callback === "function") callback();
        })
        .catch(() => {
          // Si falla, sigue con los valores por defecto
          if (typeof callback === "function") callback();
        });
    }

    function translatePage(language) {
      idiomaActual = language; // Actualiza la variable global idiomaActual
      document.body.dir = (language === 'he') ? 'rtl' : 'ltr';
      document.title = translations[language]["page-title"];

      document.querySelectorAll('[data-i18n]').forEach(el => {
        const key = el.getAttribute('data-i18n');
        if (translations[language][key]) { // Asegurarse de que la clave exista
          el.textContent = translations[language][key];
        }
      });
      // Actualiza el estado activo de los botones de idioma
      document.getElementById('btn-es').classList.toggle('active', language === 'es');
      document.getElementById('btn-he').classList.toggle('active', language === 'he');
      // Guarda la preferencia de idioma en localStorage
      localStorage.setItem('idiomaPreferido', language);
      // Re-renderizar las tarjetas para asegurar que las descripciones se traduzcan
      renderCityCards();
    }

    function cambiarMoneda(moneda) {
      monedaActual = moneda; // Actualiza la variable global monedaActual
      document.getElementById('btn-ars').classList.toggle('active', moneda === 'ARS');
      document.getElementById('btn-usd').classList.toggle('active', moneda === 'USD');
      document.getElementById('btn-ils').classList.toggle('active', moneda === 'ILS');
      // Guarda la preferencia de moneda en localStorage
      localStorage.setItem('monedaPreferida', moneda);
      // No hay precios en esta p√°gina, solo tiempos, por lo que no es necesario re-renderizar nada m√°s.
    }

    // Funci√≥n para cargar los datos detallados de una ciudad desde el JSON
    async function loadCityDetails(cityId) {
      const currentLanguage = localStorage.getItem('idiomaPreferido') || 'es';
      try {
        // Aseg√∫rate de que la ruta al JSON sea correcta si el archivo est√° en otro lugar
        const response = await fetch(`locales/${currentLanguage}.json`);
        if (!response.ok) {
          throw new Error(`HTTP error! status: ${response.status}`);
        }
        const data = await response.json();
        return data[cityId]; // Retorna el objeto completo de la ciudad
      } catch (error) {
        console.error("Error loading city details JSON:", error);
        return null;
      }
    }

    // Funci√≥n gen√©rica para llamar a la API de Gemini
    async function callGeminiAPI(promptKey, responseDivId, buttonId, loadingIndicatorId, cityId) {
      const button = document.getElementById(buttonId);
      const loadingIndicator = document.getElementById(loadingIndicatorId);
      const responseDiv = document.getElementById(responseDivId);

      button.disabled = true;
      loadingIndicator.style.display = 'block';
      responseDiv.textContent = ''; // Limpiar respuesta anterior

      const currentLanguage = localStorage.getItem('idiomaPreferido') || 'es';
      const cityDetails = await loadCityDetails(cityId); // Cargar detalles de la ciudad para el prompt

      let promptText = translations[currentLanguage][promptKey];

      // Personalizar el prompt con el nombre de la ciudad
      if (cityDetails && cityDetails.cityName) {
        promptText = promptText.replace("[CITY_NAME]", cityDetails.cityName);
      } else {
        // Fallback si no se encuentra el nombre de la ciudad
        promptText = promptText.replace("[CITY_NAME]", "la ciudad");
      }

      if (!promptText) {
        responseDiv.textContent = translations[currentLanguage]["ai-error"];
        console.error(`Error: Prompt con clave '${promptKey}' no encontrado para el idioma '${currentLanguage}'.`);
        button.disabled = false;
        loadingIndicator.style.display = 'none';
        return;
      }

      let chatHistory = [];
      chatHistory.push({ role: "user", parts: [{ text: promptText }] });

      const payload = {
        contents: chatHistory,
        generationConfig: {
            responseMimeType: "text/plain"
        }
      };

      const apiKey = ""; // La clave API se proporcionar√° en tiempo de ejecuci√≥n por el entorno Canvas
      const apiUrl = `https://generativelanguage.googleapis.com/v1beta/models/gemini-2.0-flash:generateContent?key=${apiKey}`;

      try {
        const response = await fetch(apiUrl, {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify(payload)
        });

        const result = await response.json();

        if (result.candidates && result.candidates.length > 0 &&
            result.candidates[0].content && result.candidates[0].content.parts &&
            result.candidates[0].content.parts.length > 0) {
          const text = result.candidates[0].content.parts[0].text;
          responseDiv.textContent = text;
        } else {
          responseDiv.textContent = translations[currentLanguage]["ai-error"];
          console.error("Estructura de respuesta inesperada del LLM:", result);
        }
      } catch (error) {
        responseDiv.textContent = translations[currentLanguage]["ai-error"];
        console.error("Error al llamar a la API de Gemini:", error);
      } finally {
        button.disabled = false;
        loadingIndicator.style.display = 'none';
      }
    }

    // Funci√≥n para mostrar el modal con los detalles de la ciudad
    async function mostrarDetalle(cityId) {
      const details = await loadCityDetails(cityId);
      const modalContentDiv = document.getElementById('contenido-modal');
      const modal = document.getElementById('modal-detalle');

      if (!details) {
        modalContentDiv.innerHTML = `<p>${translations[idiomaActual]["modal-coming-soon"]}</p>`;
        modal.style.display = 'flex';
        return;
      }

      // Construir la galer√≠a de im√°genes
      const galleryHtml = details.imageGallery.map(imgSrc => `
        <img src="${imgSrc}" alt="${details.cityName}" onerror="this.src='https://placehold.co/150x100/cccccc/333333?text=Img'" />
      `).join('');

      // Construir la lista de restaurantes
      const restaurantsHtml = details.restaurants.map(rest => `
        <li><a href="${rest.link}" target="_blank">${rest.name}</a></li>
      `).join('');

      modalContentDiv.innerHTML = `
        <img src="${details.mainImage}" alt="${details.cityName}" class="modal-main-image" onerror="this.src='https://placehold.co/600x220/cccccc/333333?text=Imagen+Principal'" />
        <h2>${details.cityName}</h2>
        <p>${details.welcomeText}</p>

        <h3>${translations[idiomaActual]["modal-activities-title"]}</h3>
        <ul>
          ${details.activities.map(activity => `<li>${activity}</li>`).join('')}
        </ul>

        <h3>${translations[idi18n_actual]["modal-accommodation-title"]}</h3>
        <p>
          ${details.accommodation.text}
          <br>
          <a href="${details.accommodation.bookingLink}" target="_blank">${translations[idiomaActual]["booking-link"]}</a>
          &nbsp;|&nbsp;
          <a href="${details.accommodation.airbnbLink}" target="_blank">${translations[idiomaActual]["airbnb-link"]}</a>
        </p>

        <h3>${translations[idiomaActual]["modal-restaurants-title"]}</h3>
        <ul>
          ${restaurantsHtml}
        </ul>

        <h3>${translations[idiomaActual]["modal-health-title"]}</h3>
        <p>${details.health}</p>

        <h3>${translations[idiomaActual]["modal-transport-title"]}</h3>
        <p>
          ${details.transport.text}
          <br>
          <a href="${details.transport.link}" target="_blank">${translations[idiomaActual]["general-transport-link"]}</a>
        </p>

        <h3>${translations[idiomaActual]["modal-gallery-title"]}</h3>
        <div class="gallery">
          ${galleryHtml}
        </div>

        <h3>${translations[idiomaActual]["modal-map-title"]}</h3>
        <iframe src="${details.mapEmbed}" style="border:1px solid #ccc; width:100%; height:200px; border-radius:8px;" allowfullscreen="" loading="lazy"></iframe>

        <div class="ai-section">
          <h3 data-i18n="ai-menu-title">${translations[idiomaActual]["ai-menu-title"]}</h3>
          <p data-i18n="ai-menu-description">${translations[idiomaActual]["ai-menu-description"]}</p>
          <button class="ai-button" id="generate-menu-btn" data-i18n="generate-menu-button">${translations[idiomaActual]["generate-menu-button"]}</button>
          <div class="ai-loading" id="ai-menu-loading-indicator" style="display:none;" data-i18n="ai-loading">${translations[idiomaActual]["ai-loading"]}</div>
          <div class="ai-response" id="ai-menu-response"></div>
        </div>

        <div class="ai-section">
          <h3 data-i18n="ai-accommodation-title">${translations[idiomaActual]["ai-accommodation-title"]}</h3>
          <p data-i18n="ai-accommodation-description">${translations[idiomaActual]["ai-accommodation-description"]}</p>
          <button class="ai-button" id="generate-accommodation-btn" data-i18n="generate-accommodation-button">${translations[idiomaActual]["generate-accommodation-button"]}</button>
          <div class="ai-loading" id="ai-accommodation-loading-indicator" style="display:none;" data-i18n="ai-loading">${translations[idiomaActual]["ai-loading"]}</div>
          <div class="ai-response" id="ai-accommodation-response"></div>
        </div>

        <div class="ai-section">
          <h3 data-i18n="ai-family-tips-title">${translations[idiomaActual]["ai-family-tips-title"]}</h3>
          <p data-i18n="ai-family-tips-description">${translations[idiomaActual]["ai-family-tips-description"]}</p>
          <button class="ai-button" id="generate-family-tips-btn" data-i18n="generate-family-tips-button">${translations[idiomaActual]["generate-family-tips-button"]}</button>
          <div class="ai-loading" id="ai-family-tips-loading-indicator" style="display:none;" data-i18n="ai-loading">${translations[idiomaActual]["ai-loading"]}</div>
          <div class="ai-response" id="ai-family-tips-response"></div>
        </div>

        <div class="ai-section">
          <h3 data-i18n="ai-budget-title">${translations[idiomaActual]["ai-budget-title"]}</h3>
          <p data-i18n="ai-budget-description">${translations[idiomaActual]["ai-budget-description"]}</p>
          <button class="ai-button" id="generate-budget-btn" data-i18n="generate-budget-button">${translations[idiomaActual]["generate-budget-button"]}</button>
          <div class="ai-loading" id="ai-budget-loading-indicator" style="display:none;" data-i18n="ai-loading">${translations[idiomaActual]["ai-loading"]}</div>
          <div class="ai-response" id="ai-budget-response"></div>
        </div>

        <a href="ciudades/${cityId}.html" style="color:#007BFF; text-decoration:underline; display:block; margin-top:20px; text-align:center;" target="_blank">
          ${translations[idiomaActual]["modal-full-itinerary-link"]}
        </a>
      `;

      modal.style.display = 'flex';
      // Asegurarse de que el scroll del modal est√© al inicio
      modalContentDiv.scrollTop = 0;

      // Asocia los eventos click a los botones de IA *despu√©s* de que el contenido del modal se haya renderizado
      // Pasa el cityId a la funci√≥n callGeminiAPI para que el prompt sea espec√≠fico de la ciudad
      document.getElementById('generate-menu-btn').onclick = () =>
        callGeminiAPI('ai-menu-prompt', 'ai-menu-response', 'generate-menu-btn', 'ai-menu-loading-indicator', cityId);
      document.getElementById('generate-accommodation-btn').onclick = () =>
        callGeminiAPI('ai-accommodation-prompt', 'ai-accommodation-response', 'generate-accommodation-btn', 'ai-accommodation-loading-indicator', cityId);
      document.getElementById('generate-family-tips-btn').onclick = () =>
        callGeminiAPI('ai-family-tips-prompt', 'ai-family-tips-response', 'generate-family-tips-btn', 'ai-family-tips-loading-indicator', cityId);
      document.getElementById('generate-budget-btn').onclick = () =>
        callGeminiAPI('ai-budget-prompt', 'ai-budget-response', 'generate-budget-btn', 'ai-budget-loading-indicator', cityId);
    }

    function cerrarModal() {
      document.getElementById('modal-detalle').style.display = 'none';
    }

    // Funci√≥n para renderizar las tarjetas de ciudad
    function renderCityCards() {
      const cityGrid = document.getElementById('city-grid');
      cityGrid.innerHTML = ''; // Limpiar cuadr√≠cula existente

      citiesData.forEach(city => {
        const card = document.createElement('div');
        card.classList.add('city-card');
        card.setAttribute('onclick', `mostrarDetalle('${city.id}')`);

        // Usar la descripci√≥n traducida para la tarjeta
        const cityDescriptionKey = `${city.id}Description`; // Asumiendo que tendr√°s una clave de descripci√≥n en tu JSON
        const displayedDescription = translations[idiomaActual][cityDescriptionKey] || city.description;


        card.innerHTML = `
          <img src="${city.image}" alt="${city.name}" onerror="this.src='https://placehold.co/300x180/cccccc/333333?text=${city.name}'">
          <div class="city-card-content">
            <h2>${city.name}</h2>
            <p>${displayedDescription}</p>
            <a href="ciudades/${city.id}.html" class="details-link" data-i18n="read-more" target="_blank">${translations[idiomaActual]["read-more"]}</a>
          </div>
        `;
        cityGrid.appendChild(card);
      });
    }

    // Inicializaci√≥n de la p√°gina al cargar el DOM
    document.addEventListener('DOMContentLoaded', function() {
      // Carga las preferencias de idioma y moneda desde localStorage
      const idiomaGuardado = localStorage.getItem('idiomaPreferido');
      const monedaGuardada = localStorage.getItem('monedaPreferida');

      // Actualiza las tasas de cambio y luego renderiza todo
      actualizarTasas(function() {
        // Aplica el idioma guardado o 'es' por defecto
        translatePage(idiomaGuardado || 'es');
        // Aplica la moneda guardada o 'ARS' por defecto
        cambiarMoneda(monedaGuardada || 'ARS');
        // Renderiza las tarjetas de ciudad inicialmente
        renderCityCards();
      });
    });
  </script>
</body>
</html>
