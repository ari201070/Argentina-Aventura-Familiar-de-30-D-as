<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <title>Itinerario Familiar por Argentina</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link href="https://cdn.jsdelivr.net/npm/tailwindcss@2.2.19/dist/tailwind.min.css" rel="stylesheet">
    <style>
        body {
            background: #f8f9fa;
        }
        .main-card {
            background: #fff;
            border-radius: 12px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.07);
            padding: 2rem 2.5rem;
            margin-top: 2rem;
        }
        .table th, .table td {
            padding: 0.5em 1em;
            border: 1px solid #dee2e6;
        }
        .table th {
            background: #e7eef7;
        }
        .currency-btn, .lang-btn {
            padding: 0.3em 1.1em;
            border: 1px solid #ccc;
            border-radius: 6px;
            margin-right: 0.3em;
            background: #f8f9fa;
            font-weight: bold;
            cursor: pointer;
        }
        .currency-btn.active, .lang-btn.active {
            background: #e7eef7;
            border-color: #5D5CDE;
            color: #222;
        }
        .currency-btn:last-child, .lang-btn:last-child {
            margin-right: 0;
        }
        .label {
            font-weight: bold;
            margin-right: 0.4em;
        }
        @media (max-width: 640px) {
            .main-card { padding: 1em 0.3em; }
            table { font-size: 0.96em; }
        }
        .card-tool {
            background: #fff;
            border-radius: 1rem;
            box-shadow: 0 2px 10px rgba(0,0,0,0.07);
            padding: 2rem;
            margin-top: 2.5rem;
        }
        .primary-btn {
            background: #5D5CDE;
            color: #fff;
            border-radius: 0.5rem;
            padding: 0.5rem 1.5rem;
            transition: background 0.2s;
        }
        .primary-btn:hover {
            background: #4a49b0;
        }
        .loading-spinner {
            display: inline-block;
            width: 20px;
            height: 20px;
            border: 3px solid rgba(93,92,222,0.3);
            border-radius: 50%;
            border-top-color: #5D5CDE;
            animation: spin 1s linear infinite;
        }
        @keyframes spin { to { transform: rotate(360deg); } }
        .rtl { direction: rtl; }
    </style>
</head>
<body class="min-h-screen">

    <!-- Barra superior (idioma y moneda) -->
    <div class="w-full flex justify-end px-8 pt-4 text-gray-700" style="font-size:1.05em;">
        <span class="mr-2" id="label-idioma">Idioma:</span>
        <button class="lang-btn active" id="lang-es">Español</button>
        <button class="lang-btn" id="lang-he">עברית</button>
        <span class="ml-6 mr-2" id="label-moneda">Moneda:</span>
        <button class="currency-btn active" id="cur-ARS">ARS</button>
        <button class="currency-btn" id="cur-USD">USD</button>
        <button class="currency-btn" id="cur-ILS">ILS</button>
        <button class="currency-btn" id="cur-EUR">EUR</button>
    </div>

    <!-- Tarjeta principal -->
    <div class="main-card max-w-4xl mx-auto">
        <h1 class="text-3xl font-bold mb-2" id="titulo-main">Itinerario Familiar por Argentina</h1>
        <p class="mb-6" id="bienvenida">¡Bienvenidos! Haz clic en cada ciudad para ver información, mapas y recomendaciones.</p>
        <h2 class="text-xl font-bold mb-2" id="ciudades-titulo">Ciudades y Destinos</h2>
        <ul class="mb-6 list-disc ml-6" id="lista-ciudades">
            <li><a href="#">Buenos Aires</a></li>
            <li><a href="#">Rosario</a></li>
            <li><a href="#">Bariloche</a></li>
            <li><a href="#">Mendoza</a></li>
            <li><a href="#">Malargüe</a></li>
            <li><a href="#">Jujuy</a></li>
            <li><a href="#">Iguazú</a></li>
            <li><a href="#">Corrientes</a></li>
            <li><a href="#">Iberá</a></li>
            <li><a href="#">Mapa Interactivo</a></li>
        </ul>
        <h2 class="text-xl font-bold mb-2" id="transporte-titulo">Transporte entre ciudades</h2>
        <div class="overflow-x-auto">
        <table class="table min-w-full text-left border-collapse mb-2">
            <thead>
                <tr>
                    <th id="desde-th">Desde</th>
                    <th id="hasta-th">Hasta</th>
                    <th id="medio-th">Medio</th>
                    <th id="tiempo-th">Tiempo</th>
                    <th id="precio-th">Precio aprox.</th>
                    <th id="compania-th">Compañía</th>
                </tr>
            </thead>
            <tbody>
                <tr>
                    <td>Buenos Aires</td><td>Rosario</td><td>Bus</td><td>4 h</td><td><span class="price" data-ars="20000" data-usd="22" data-ils="80" data-eur="20">$ 20000</span></td><td><a href="https://www.busplus.com.ar/" target="_blank">BusPlus</a></td>
                </tr>
                <tr>
                    <td>Rosario</td><td>Mendoza</td><td>Bus</td><td>13 h</td><td><span class="price" data-ars="50000" data-usd="55" data-ils="200" data-eur="50">$ 50000</span></td><td><a href="https://www.andesmar.com/" target="_blank">Andesmar</a></td>
                </tr>
                <tr>
                    <td>Mendoza</td><td>Malargüe</td><td>Bus</td><td>6 h</td><td><span class="price" data-ars="18000" data-usd="20" data-ils="72" data-eur="18">$ 18000</span></td><td><a href="https://www.catainternacional.com/" target="_blank">CATA</a></td>
                </tr>
                <tr>
                    <td>Malargüe</td><td>Jujuy</td><td>Vuelo + Bus</td><td>10 h</td><td><span class="price" data-ars="110000" data-usd="120" data-ils="440" data-eur="100">$ 110000</span></td><td><a href="https://www.pasajesenmicros.com.ar/" target="_blank">Pasajes de micro baratos</a></td>
                </tr>
                <tr>
                    <td>Jujuy</td><td>Iguazú</td><td>Vuelo</td><td>2 h</td><td><span class="price" data-ars="85000" data-usd="90" data-ils="330" data-eur="77">$ 85000</span></td><td><a href="https://www.aerolineas.com.ar/" target="_blank">Aerolineas Argentinas</a></td>
                </tr>
                <tr>
                    <td>Iguazú</td><td>Corrientes</td><td>Bus</td><td>9 h</td><td><span class="price" data-ars="40000" data-usd="44" data-ils="155" data-eur="40">$ 40000</span></td><td><a href="https://www.crucerodelnorte.com.ar/" target="_blank">Crucero del Norte</a></td>
                </tr>
                <tr>
                    <td>Corrientes</td><td>Esteros del Iberá</td><td>Remis/Transfer</td><td>4 h</td><td><span class="price" data-ars="60000" data-usd="66" data-ils="240" data-eur="60">$ 60000</span></td><td><a href="https://www.esterosdelibera.com/" target="_blank">Esteros del Iberá</a></td>
                </tr>
            </tbody>
        </table>
        </div>
        <div class="text-sm text-gray-500 mt-2">Powered by <a href="https://www.exchangerate-api.com/" target="_blank" class="underline text-blue-500">ExchangeRate-API.com</a></div>
    </div>

    <!-- ============================= -->
    <!-- === HERRAMIENTAS NUEVAS ==== -->
    <!-- ============================= -->

    <!-- Conversor de moneda actualizable -->
    <section class="card-tool max-w-4xl mx-auto" id="moderno-conversor-moneda">
        <h2 class="text-xl font-bold mb-3 flex items-center gap-2" id="titulo-conversor"><i class="fas fa-dollar-sign text-green-500"></i> Conversor de moneda</h2>
        <div class="grid grid-cols-1 md:grid-cols-4 gap-4">
            <div>
                <label for="amount" class="block mb-1" id="label-cantidad">Cantidad:</label>
                <input type="number" id="amount" class="w-full px-3 py-2 border rounded text-base" value="100">
            </div>
            <div>
                <label for="from-currency" class="block mb-1" id="label-de">De:</label>
                <select id="from-currency" class="w-full px-3 py-2 border rounded text-base">
                    <option value="ARS">ARS (Peso Argentino)</option>
                    <option value="USD">USD (Dólar US)</option>
                    <option value="EUR">EUR (Euro)</option>
                    <option value="ILS">ILS (Shekel)</option>
                </select>
            </div>
            <div>
                <label for="to-currency" class="block mb-1" id="label-a">A:</label>
                <select id="to-currency" class="w-full px-3 py-2 border rounded text-base">
                    <option value="USD">USD (Dólar US)</option>
                    <option value="ARS">ARS (Peso Argentino)</option>
                    <option value="EUR">EUR (Euro)</option>
                    <option value="ILS">ILS (Shekel)</option>
                </select>
            </div>
            <div class="flex items-end">
                <button id="convert-btn" class="primary-btn flex items-center gap-2 w-full">
                    <span id="btn-convertir">Convertir</span>
                    <div id="currency-loading" class="loading-spinner hidden"></div>
                </button>
            </div>
        </div>
        <div class="mt-4 flex items-center gap-4">
            <span id="conversion-result" class="font-bold text-lg"></span>
        </div>
        <div class="mt-2 text-sm text-gray-500">
            <span id="currency-date"></span><br>
            Fuente: <a href="https://polygon.io/" target="_blank" class="underline text-blue-500">Polygon.io</a>
        </div>
    </section>

    <!-- Lista de equipaje -->
    <section class="card-tool max-w-4xl mx-auto">
        <h2 class="text-xl font-bold mb-3 flex items-center gap-2" id="packing-title"><i class="fas fa-suitcase-rolling text-yellow-500"></i> Lista de equipaje</h2>
        <div class="flex items-center space-x-2 mb-4">
            <input type="text" id="packing-item" class="flex-grow px-3 py-2 border rounded text-base" placeholder="Agregar ítem...">
            <select id="packing-select" class="px-2 py-2 border rounded text-base">
                <option value="esencial">Esencial</option>
                <option value="opcional">Opcional</option>
            </select>
            <button id="add-item" class="primary-btn"><i class="fas fa-plus"></i></button>
        </div>
        <div>
            <h4 class="font-semibold mb-2" id="packing-esenciales">Esenciales:</h4>
            <ul id="packing-list" class="space-y-2">
                <li class="flex items-center">
                    <input type="checkbox" id="item-passport" class="mr-2">
                    <label for="item-passport">Pasaporte y documentos</label>
                </li>
                <li class="flex items-center">
                    <input type="checkbox" id="item-insurance" class="mr-2">
                    <label for="item-insurance">Seguro de viaje</label>
                </li>
                <li class="flex items-center">
                    <input type="checkbox" id="item-medication" class="mr-2">
                    <label for="item-medication">Medicamentos</label>
                </li>
            </ul>
        </div>
        <div class="mt-4">
            <h4 class="font-semibold mb-2" id="packing-opcionales">Opcionales:</h4>
            <ul id="optional-packing-list" class="space-y-2"></ul>
        </div>
    </section>

    <!-- Consulta a IA -->
    <section class="card-tool max-w-4xl mx-auto">
        <h2 class="text-xl font-bold mb-3 flex items-center gap-2" id="ai-title"><i class="fas fa-robot text-indigo-500"></i> Consulta a la IA</h2>
        <p class="mb-4" id="ai-desc">Haz cualquier pregunta sobre tu viaje familiar a Argentina y recibe una respuesta experta y personalizada.</p>
        <div>
            <textarea id="ai-prompt" class="w-full px-3 py-2 border rounded text-base mb-2" rows="3" placeholder="Ej: ¿Qué ropa llevar para Bariloche en octubre?"></textarea>
            <div class="flex gap-2 mb-2">
                <button id="ask-ai" class="primary-btn flex-1" type="button">Consultar</button>
                <button id="clear-ai" class="bg-gray-400 text-white rounded px-4 py-2 hover:bg-gray-600"><i class="fas fa-times"></i></button>
            </div>
            <div id="ai-loading" class="text-center py-2 hidden">
                <div class="inline-block w-8 h-8 border-4 border-gray-300 border-t-indigo-500 rounded-full animate-spin"></div>
                <p class="mt-2" id="ai-loading-text">Procesando tu consulta...</p>
            </div>
            <div id="ai-response" class="mt-4 p-4 bg-gray-100 rounded max-h-64 overflow-y-auto hidden"></div>
        </div>
    </section>

    <footer class="w-full bg-gray-100 py-4 mt-8">
        <div class="container mx-auto text-center text-gray-500" id="footer-copyright">
            © 2025 Argentina Aventura Familiar | Herramientas útiles para viajeros
        </div>
    </footer>

    <script src="https://kit.fontawesome.com/20c306f2e2.js" crossorigin="anonymous"></script>
    <script>
        // Traducciones
        const translations = {
            es: {
                idioma: "Idioma:",
                moneda: "Moneda:",
                "Itinerario Familiar por Argentina": "Itinerario Familiar por Argentina",
                bienvenida: "¡Bienvenidos! Haz clic en cada ciudad para ver información, mapas y recomendaciones.",
                "Ciudades y Destinos": "Ciudades y Destinos",
                "Transporte entre ciudades": "Transporte entre ciudades",
                Desde: "Desde",
                Hasta: "Hasta",
                Medio: "Medio",
                Tiempo: "Tiempo",
                "Precio aprox.": "Precio aprox.",
                Compañía: "Compañía",
                "Conversor de moneda": "Conversor de moneda",
                Cantidad: "Cantidad:",
                De: "De:",
                A: "A:",
                Convertir: "Convertir",
                Esenciales: "Esenciales:",
                Opcionales: "Opcionales:",
                "Lista de equipaje": "Lista de equipaje",
                "Pasaporte y documentos": "Pasaporte y documentos",
                "Seguro de viaje": "Seguro de viaje",
                Medicamentos: "Medicamentos",
                "Agregar ítem...": "Agregar ítem...",
                Esencial: "Esencial",
                Opcional: "Opcional",
                "Consulta a la IA": "Consulta a la IA",
                "Haz cualquier pregunta sobre tu viaje familiar a Argentina y recibe una respuesta experta y personalizada.": "Haz cualquier pregunta sobre tu viaje familiar a Argentina y recibe una respuesta experta y personalizada.",
                "Procesando tu consulta...": "Procesando tu consulta...",
                Consultar: "Consultar",
                "© 2025 Argentina Aventura Familiar | Herramientas útiles para viajeros": "© 2025 Argentina Aventura Familiar | Herramientas útiles para viajeros"
            },
            he: {
                idioma: "שפה:",
                moneda: "מטבע:",
                "Itinerario Familiar por Argentina": "מסלול משפחתי בארגנטינה",
                bienvenida: "!ברוכים הבאים! לחץ על כל עיר להצגת מידע, מפות והמלצות.",
                "Ciudades y Destinos": "ערים ויעדים",
                "Transporte entre ciudades": "תחבורה בין ערים",
                Desde: "מ-",
                Hasta: "ל-",
                Medio: "אמצעי",
                Tiempo: "משך",
                "Precio aprox.": "מחיר משוער",
                Compañía: "חברה",
                "Conversor de moneda": "ממיר מטבעות",
                Cantidad: "כמות:",
                De: "מ:",
                A: "ל:",
                Convertir: "המר",
                Esenciales: "חיוניים:",
                Opcionales: "רשות:",
                "Lista de equipaje": "רשימת ציוד",
                "Pasaporte y documentos": "דרכון ומסמכים",
                "Seguro de viaje": "ביטוח נסיעות",
                Medicamentos: "תרופות",
                "Agregar ítem...": "הוסף פריט...",
                Esencial: "חיוני",
                Opcional: "רשות",
                "Consulta a la IA": "שאל את הבינה המלאכותית",
                "Haz cualquier pregunta sobre tu viaje familiar a Argentina y recibe una respuesta experta y personalizada.": "שאל כל שאלה על הטיול המשפחתי שלך וקבל תשובה מותאמת אישית.",
                "Procesando tu consulta...": "מעבד את שאלתך...",
                Consultar: "שאל",
                "© 2025 Argentina Aventura Familiar | Herramientas útiles para viajeros": "© 2025 מסע משפחתי בארגנטינה | כלים שימושיים למטיילים"
            }
        };

        let currentLang = "es";
        function updateTranslations() {
            const t = translations[currentLang];
            document.getElementById('label-idioma').textContent = t.idioma;
            document.getElementById('label-moneda').textContent = t.moneda;
            document.getElementById('titulo-main').textContent = t["Itinerario Familiar por Argentina"];
            document.getElementById('bienvenida').textContent = t.bienvenida;
            document.getElementById('ciudades-titulo').textContent = t["Ciudades y Destinos"];
            document.getElementById('transporte-titulo').textContent = t["Transporte entre ciudades"];
            document.getElementById('desde-th').textContent = t.Desde;
            document.getElementById('hasta-th').textContent = t.Hasta;
            document.getElementById('medio-th').textContent = t.Medio;
            document.getElementById('tiempo-th').textContent = t.Tiempo;
            document.getElementById('precio-th').textContent = t["Precio aprox."];
            document.getElementById('compania-th').textContent = t.Compañía;
            document.getElementById('titulo-conversor').innerHTML = `<i class="fas fa-dollar-sign text-green-500"></i> ${t["Conversor de moneda"]}`;
            document.getElementById('label-cantidad').textContent = t.Cantidad;
            document.getElementById('label-de').textContent = t.De;
            document.getElementById('label-a').textContent = t.A;
            document.getElementById('btn-convertir').textContent = t.Convertir;
            document.getElementById('packing-title').innerHTML = `<i class="fas fa-suitcase-rolling text-yellow-500"></i> ${t["Lista de equipaje"]}`;
            document.getElementById('packing-esenciales').textContent = t.Esenciales;
            document.getElementById('packing-opcionales').textContent = t.Opcionales;
            document.getElementById('packing-item').placeholder = t["Agregar ítem..."];
            document.getElementById('packing-select').options[0].text = t.Esencial;
            document.getElementById('packing-select').options[1].text = t.Opcional;
            document.querySelector('#item-passport + label').textContent = t["Pasaporte y documentos"];
            document.querySelector('#item-insurance + label').textContent = t["Seguro de viaje"];
            document.querySelector('#item-medication + label').textContent = t.Medicamentos;
            document.getElementById('ai-title').innerHTML = `<i class="fas fa-robot text-indigo-500"></i> ${t["Consulta a la IA"]}`;
            document.getElementById('ai-desc').textContent = t["Haz cualquier pregunta sobre tu viaje familiar a Argentina y recibe una respuesta experta y personalizada."];
            document.getElementById('ask-ai').textContent = t.Consultar;
            document.getElementById('ai-loading-text').textContent = t["Procesando tu consulta..."];
            document.getElementById('footer-copyright').textContent = t["© 2025 Argentina Aventura Familiar | Herramientas útiles para viajeros"];
            // RTL
            document.body.classList.toggle('rtl', currentLang === 'he');
        }
        document.getElementById('lang-es').onclick = () => {
            currentLang = "es";
            document.querySelectorAll('.lang-btn').forEach(b => b.classList.remove('active'));
            document.getElementById('lang-es').classList.add('active');
            updateTranslations();
        };
        document.getElementById('lang-he').onclick = () => {
            currentLang = "he";
            document.querySelectorAll('.lang-btn').forEach(b => b.classList.remove('active'));
            document.getElementById('lang-he').classList.add('active');
            updateTranslations();
        };
        // Inicializar traducciones
        window.addEventListener('DOMContentLoaded', updateTranslations);

        // --- Moneda y cambio en tabla ---
        const currencyBtns = document.querySelectorAll('.currency-btn');
        let currentCurrency = 'ARS';
        function updatePrices() {
            document.querySelectorAll('.price').forEach(span => {
                let value = span.getAttribute('data-' + currentCurrency.toLowerCase());
                let symbol = currentCurrency === 'ARS' ? '$ ' : (currentCurrency === 'USD' ? 'US$ ' : (currentCurrency === 'ILS' ? '₪ ' : '€ '));
                span.textContent = symbol + value;
            });
        }
        currencyBtns.forEach(btn => {
            btn.onclick = () => {
                currencyBtns.forEach(b => b.classList.remove('active'));
                btn.classList.add('active');
                currentCurrency = btn.id.replace('cur-','');
                updatePrices();
            };
        });
        updatePrices();

        // --- Conversor de moneda con Polygon.io ---
        const polygonKey = "JGaKP6lqstTjGs2q0jBEKAq3PQFjrkCx";
        const pairs = {
            "USD_ARS": "C:USDARS",
            "ARS_USD": "C:ARSUSD",
            "USD_EUR": "C:USDEUR",
            "EUR_USD": "C:EURUSD",
            "USD_ILS": "C:USDILS",
            "ILS_USD": "C:ILSUSD",
            "EUR_ARS": "C:EURARS",
            "ARS_EUR": "C:ARSEUR",
            "EUR_ILS": "C:EURILS",
            "ILS_EUR": "C:ILSEUR",
            "ARS_ILS": "C:ARSILS",
            "ILS_ARS": "C:ILSARS"
        };
        async function fetchPolygonRate(from, to) {
            if (from === to) return 1;
            let symbol = pairs[`${from}_${to}`];
            if (!symbol) return null;
            let url = `https://api.polygon.io/v2/aggs/ticker/${symbol}/prev?adjusted=true&apiKey=${polygonKey}`;
            let res = await fetch(url);
            let data = await res.json();
            if (data && data.results && data.results[0] && data.results[0].c) {
                return data.results[0].c;
            }
            return null;
        }
        async function convertCurrency() {
            document.getElementById('conversion-result').textContent = "";
            document.getElementById('currency-loading').classList.remove('hidden');
            const amount = parseFloat(document.getElementById('amount').value);
            const from = document.getElementById('from-currency').value;
            const to = document.getElementById('to-currency').value;
            if (from === to) {
                document.getElementById('conversion-result').textContent = `${amount} ${from} = ${amount} ${to}`;
                document.getElementById('currency-loading').classList.add('hidden');
                return;
            }
            let rate = await fetchPolygonRate(from, to);
            if (rate === null) {
                document.getElementById('conversion-result').textContent = "Conversión no disponible.";
            } else {
                let symbol = to === 'ARS' ? '$ ' : (to === 'USD' ? 'US$ ' : (to === 'ILS' ? '₪ ' : '€ '));
                document.getElementById('conversion-result').textContent =
                    `${amount} ${from} = ${symbol}${(amount * rate).toLocaleString(undefined, {maximumFractionDigits: 2})} ${to}`;
            }
            document.getElementById('currency-loading').classList.add('hidden');
            document.getElementById('currency-date').textContent = ""; // Polygon.io solo devuelve la última (normalmente ayer)
        }
        document.getElementById('convert-btn').addEventListener('click', convertCurrency);

        // --- Lista de equipaje con esenciales y opcionales ---
        const packingKey = "equipaje_argentina";
        function savePackingList() {
            const esenciales = Array.from(document.querySelectorAll('#packing-list > li')).map(li => ({
                id: li.querySelector('input').id,
                checked: li.querySelector('input').checked,
                text: li.querySelector('label').textContent
            }));
            const opcionales = Array.from(document.querySelectorAll('#optional-packing-list > li')).map(li => ({
                id: li.querySelector('input').id,
                checked: li.querySelector('input').checked,
                text: li.querySelector('label').textContent
            }));
            localStorage.setItem(packingKey, JSON.stringify({esenciales, opcionales}));
        }
        function loadPackingList() {
            const data = JSON.parse(localStorage.getItem(packingKey) || "{}");
            // Esenciales
            const ul = document.getElementById('packing-list');
            ul.innerHTML = `
                <li class="flex items-center">
                    <input type="checkbox" id="item-passport" class="mr-2">
                    <label for="item-passport">${translations[currentLang]["Pasaporte y documentos"]}</label>
                </li>
                <li class="flex items-center">
                    <input type="checkbox" id="item-insurance" class="mr-2">
                    <label for="item-insurance">${translations[currentLang]["Seguro de viaje"]}</label>
                </li>
                <li class="flex items-center">
                    <input type="checkbox" id="item-medication" class="mr-2">
                    <label for="item-medication">${translations[currentLang]["Medicamentos"]}</label>
                </li>
            `;
            if (data.esenciales) {
                data.esenciales.forEach(item => {
                    if (!["item-passport","item-insurance","item-medication"].includes(item.id)) {
                        addCustomPackingItem(item.text, item.checked, true);
                    } else {
                        const el = document.getElementById(item.id);
                        if (el) el.checked = item.checked;
                    }
                });
            }
            // Opcionales
            const ulO = document.getElementById('optional-packing-list');
            ulO.innerHTML = "";
            if (data.opcionales) {
                data.opcionales.forEach(item => {
                    addCustomPackingItem(item.text, item.checked, false, true);
                });
            }
            // Reactivar eventos
            Array.from(document.querySelectorAll('#packing-list input')).forEach(i => { i.onchange = savePackingList; });
            Array.from(document.querySelectorAll('#optional-packing-list input')).forEach(i => { i.onchange = savePackingList; });
        }
        function addCustomPackingItem(text, checked=false, esEsencial=true, esOpcional=false) {
            const id = "custom-" + Date.now() + Math.random().toString(36).substring(2,7);
            const li = document.createElement('li');
            li.className = "flex items-center justify-between custom-packing";
            li.innerHTML = `
                <div class="flex items-center">
                    <input type="checkbox" id="${id}" class="mr-2" ${checked ? "checked" : ""}>
                    <label for="${id}">${text}</label>
                </div>
                <button class="text-red-500 hover:text-red-700" title="Eliminar"><i class="fas fa-trash"></i></button>
            `;
            li.querySelector('button').onclick = () => {
                li.remove();
                savePackingList();
            };
            li.querySelector('input').onchange = savePackingList;
            if (esOpcional) {
                document.getElementById('optional-packing-list').appendChild(li);
            } else {
                document.getElementById('packing-list').appendChild(li);
            }
            savePackingList();
        }
        document.getElementById('add-item').onclick = () => {
            const input = document.getElementById('packing-item');
            const text = input.value.trim();
            const tipo = document.getElementById('packing-select').value;
            if (text) {
                if (tipo === "esencial") {
                    addCustomPackingItem(text, false, true, false);
                } else {
                    addCustomPackingItem(text, false, false, true);
                }
                input.value = "";
            }
        };
        document.getElementById('packing-item').addEventListener('keypress', (e) => {
            if (e.key === 'Enter') document.getElementById('add-item').click();
        });
        window.addEventListener('DOMContentLoaded', () => {
            loadPackingList();
            Array.from(document.querySelectorAll('#packing-list input')).forEach(i => {
                i.onchange = savePackingList;
            });
        });

        // --- Consulta a IA (mock experto viajes Argentina) ---
        function aiMockResponse(prompt) {
            const p = prompt.toLowerCase();
            if (p.includes("ropa") || p.includes("vestimenta")) {
                return `<h3>Recomendación de ropa</h3>
                <p>Para viajar a distintas regiones de Argentina en octubre, lleva ropa por capas: remera, buzo o campera liviana, y un abrigo impermeable. En Bariloche y la Patagonia, hace frío y viento, así que suma gorro y guantes. En Buenos Aires y norte, puede hacer calor durante el día y fresco por la noche.</p>`;
            }
            if (p.includes("clima") || p.includes("temperatura") || p.includes("tiempo")) {
                return `<h3>Clima en Argentina</h3>
                <p>Argentina tiene climas muy variados. En primavera (septiembre-noviembre), Buenos Aires y centro: 15-25°C, Patagonia: 5-18°C, Noroeste: 18-28°C. Consulta el pronóstico antes de viajar.</p>`;
            }
            if (p.includes("dinero") || p.includes("moneda") || p.includes("cambio")) {
                return `<h3>Consejos de dinero</h3>
                <ul>
                    <li>El peso argentino suele ser inestable. Lleva una parte en dólares o euros y cambia en casas oficiales o consulta tasas "MEP" o "Blue".</li>
                    <li>Tarjetas de crédito/débito suelen tener cotización oficial, que es menos conveniente.</li>
                    <li>Consulta siempre el tipo de cambio al día.</li>
                </ul>`;
            }
            if (p.includes("seguridad")) {
                return `<h3>Seguridad en Argentina</h3>
                <p>Argentina es generalmente segura para familias, pero en ciudades grandes cuida bolsos y objetos de valor, sobre todo en zonas turísticas y transporte público. Evita caminar solo/a de noche por zonas poco transitadas.</p>`;
            }
            if (p.includes("salud") || p.includes("medico") || p.includes("diabetes")) {
                return `<h3>Salud y seguro</h3>
                <ul>
                    <li>Lleva siempre un seguro de viaje que cubra emergencias médicas.</li>
                    <li>Si viajas con diabetes, lleva recetas y medicamentos suficientes. En farmacias grandes suelen conseguirse insumos, pero no en pueblos chicos.</li>
                    <li>El sistema de salud público es gratuito en emergencias.</li>
                </ul>`;
            }
            if (p.includes("transporte") || p.includes("viajar") || p.includes("moverse")) {
                return `<h3>Transporte</h3>
                <ul>
                    <li>Para largas distancias, lo más cómodo son los vuelos internos (Aerolíneas Argentinas, Jetsmart, Flybondi).</li>
                    <li>Entre ciudades medianas puedes usar ómnibus de larga distancia (cómodos y frecuentes).</li>
                    <li>Para moverse en ciudad, usa apps como Uber, Cabify o taxis oficiales.</li>
                </ul>`;
            }
            if (p.includes("familia") || p.includes("niño") || p.includes("nene")) {
                return `<h3>Viajar en familia</h3>
                <ul>
                    <li>La mayoría de los destinos y excursiones en Argentina son aptos para niños.</li>
                    <li>Consulta siempre si la actividad tiene restricciones de edad/altura.</li>
                    <li>En restaurantes, suelen tener menú infantil.</li>
                </ul>`;
            }
            if (p.includes("alojamiento") || p.includes("hotel") || p.includes("departamento")) {
                return `<h3>Alojamiento</h3>
                <ul>
                    <li>Para familias, recomiendo departamentos temporarios (tipo Airbnb) o cabañas, más cómodos y económicos que hotel tradicional.</li>
                    <li>En destinos turísticos reserva con anticipación, sobre todo en temporada alta.</li>
                </ul>`;
            }
            return `<h3>Consejos generales para viajar en familia a Argentina</h3>
                <ul>
                    <li>Planifica los traslados con tiempo, las distancias son grandes.</li>
                    <li>Consulta siempre el pronóstico y adapta el equipaje.</li>
                    <li>Ten siempre copia digital de documentos y contactos de emergencia.</li>
                    <li>Disfruta la gastronomía local y los paisajes. ¡Buen viaje!</li>
                </ul>`;
        }
        document.getElementById('ask-ai').onclick = function() {
            const prompt = document.getElementById('ai-prompt').value.trim();
            if (!prompt) return;
            document.getElementById('ai-loading').classList.remove('hidden');
            document.getElementById('ai-response').classList.add('hidden');
            setTimeout(() => {
                const res = aiMockResponse(prompt);
                document.getElementById('ai-response').innerHTML = res;
                document.getElementById('ai-response').classList.remove('hidden');
                document.getElementById('ai-loading').classList.add('hidden');
            }, 1100);
        };
        document.getElementById('clear-ai').onclick = function() {
            document.getElementById('ai-prompt').value = "";
            document.getElementById('ai-response').innerHTML = "";
            document.getElementById('ai-response').classList.add('hidden');
        };
    </script>
</body>
</html>