<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <title data-i18n="page-title">Malargüe | Viaje Familiar a Argentina</title>
  <link rel="stylesheet" href="estilos.css">
  <style>
    /* Estilos generales del cuerpo y barra superior */
    body {
      font-family: Arial, sans-serif;
      background: #f9f9f9;
      color: #333;
      margin: 20px;
      transition: direction 0.3s;
    }
    #language-selector {
      position: fixed;
      top: 20px;
      right: 20px;
      z-index: 1000;
      background-color: rgba(255,255,255,0.8);
      padding: 5px;
      border-radius: 5px;
      box-shadow: 0 2px 5px rgba(0,0,0,0.2);
      display: flex; /* Para alinear los botones de idioma y moneda */
      align-items: center;
      gap: 10px; /* Espacio entre elementos */
    }
    .language-btn, .currency-btn { /* Clase unificada para botones de control */
      font-weight: bold;
      padding: 8px 12px;
      margin: 0 2px;
      border: none;
      border-radius: 4px;
      cursor: pointer;
      background-color: #f0f0f0;
    }
    .language-btn.active, .currency-btn.active {
      background: #e6eaff;
      border-color: #6d7fc9;
      font-weight: bold;
    }
    .back-link {
      margin-left: 20px;
      text-decoration: none;
      font-weight: bold;
      color: #007BFF;
    }
    /* Estilos para la foto de la ciudad */
    .ciudad-foto {
      width: 100%;
      max-width: 700px;
      height: auto;
      display: block;
      margin: 30px auto 20px auto;
      border-radius: 14px;
      box-shadow: 0 3px 16px rgba(0,0,0,0.15);
    }
    .foto-caption {
      text-align: center;
      color: #555;
      font-size: 1em;
      margin-bottom: 30px;
    }
    h1, h2, h3 { /* Agregado h3 para subsecciones */
      color: #0F4761;
    }
    ul {
      margin-bottom: 20px;
      padding-left: 25px; /* Ajuste para listas */
    }
    ul li {
      margin-bottom: 5px;
    }
    iframe {
      border: 1px solid black;
      width: 100%; /* Asegura que el mapa sea responsive */
      max-width: 700px; /* Limita el ancho máximo del mapa */
      display: block;
      margin: 20px auto; /* Centra el mapa */
    }
    /* Estilos para tablas añadidas */
    table {
      border-collapse: collapse;
      width: 100%;
      max-width: 700px; /* Limita el ancho máximo de las tablas */
      margin: 20px auto;
      background: #f7fbff;
      box-shadow: 0 2px 8px rgba(0,0,0,0.05);
      border-radius: 8px;
      overflow: hidden;
    }
    th, td {
      border: 1px solid #b3c7e6;
      padding: 10px 15px;
      text-align: left;
      font-size: 16px;
    }
    th {
      background: #e6f0fa;
      font-weight: bold;
    }
    .rtl {
      direction: rtl !important;
      text-align: right !important;
    }
    .rtl ul {
      padding-right: 25px;
      padding-left: 0;
    }

    /* Estilos para las secciones de IA */
    .ai-section {
      background: #e6f0fa;
      padding: 20px;
      border-radius: 8px;
      margin: 30px auto;
      max-width: 700px;
      box-shadow: 0 2px 8px rgba(0,0,0,0.1);
    }
    .ai-section h2 {
      color: #2176d2;
      margin-top: 0;
    }
    .ai-button {
      background-color: #4CAF50; /* Green */
      color: white;
      padding: 12px 20px;
      border: none;
      border-radius: 5px;
      cursor: pointer;
      font-size: 16px;
      transition: background-color 0.3s ease;
      display: block;
      margin: 15px auto;
      max-width: 300px;
    }
    .ai-button:hover {
      background-color: #45a049;
    }
    .ai-button:disabled {
      background-color: #cccccc;
      cursor: not-allowed;
    }
    .ai-response {
      margin-top: 20px;
      padding: 15px;
      background-color: #ffffff;
      border: 1px solid #d0e0f0;
      border-radius: 5px;
      white-space: pre-wrap;
      font-size: 15px;
      line-height: 1.6;
      min-height: 50px;
    }
    .ai-loading {
      text-align: center;
      font-style: italic;
      color: #666;
      margin-top: 10px;
    }
  </style>
</head>
<body>
  <div id="language-selector">
    <span data-i18n="idioma">Idioma:</span>
    <button onclick="translatePage('es')" class="language-btn" id="btn-es">Español</button>
    <button onclick="translatePage('he')" class="language-btn" id="btn-he">עברית</button>
    <span data-i18n="moneda">Moneda:</span>
    <button id="btn-ars" onclick="cambiarMoneda('ARS')" class="currency-btn">ARS</button>
    <button id="btn-usd" onclick="cambiarMoneda('USD')" class="currency-btn">USD</button>
    <button id="btn-ils" onclick="cambiarMoneda('ILS')" class="currency-btn">ILS</button>
    <a href="../index.html" class="back-link" id="back-link" data-i18n="back-link">⬅ Volver al itinerario</a>
  </div>

  <img src="../docs/imagenes/malargue/malargue.jpg"
       alt="Paisaje volcánico de Malargüe"
       class="ciudad-foto" id="city-photo" onerror="this.src='https://placehold.co/700x400/cccccc/333333?text=Imagen+Malarg%C3%BCe'">
  <div class="foto-caption" id="foto-caption" data-i18n="foto-caption">Paisaje volcánico de Malargüe</div>

  <h1 id="city-title" data-i18n="city-title">Malargüe</h1>
  <p id="welcome-text" data-i18n="welcome-text">Malargüe es una ciudad en el sur de Mendoza, conocida por sus paisajes volcánicos, formaciones geológicas únicas y aventuras en la naturaleza. Es la puerta de entrada a atractivos como la Caverna de las Brujas y la Laguna de la Niña Encantada.</p>

  <h2 data-i18n="dates-duration-title">Fechas y duración</h2>
  <ul>
    <li data-i18n="stay-duration">**Estadía**: 13/10 al 16/10 (4 días)</li>
    <li data-i18n="how-to-arrive">**Cómo llegar**: Bus desde Mendoza / Auto de alquiler</li>
  </ul>

  <h2 id="main-attractions-title" data-i18n="main-attractions-title">Lugares imperdibles</h2>
  <ul id="main-attractions-list">
    <li><a href="https://www.malargue.tur.ar/caverna-de-las-brujas/" target="_blank" id="attraction-0" data-i18n="attraction-0">Caverna de las Brujas</a></li>
    <li><a href="https://www.malargue.tur.ar/la-payunia/" target="_blank" id="attraction-1" data-i18n="attraction-1">La Payunia</a></li>
    <li><a href="https://www.malargue.tur.ar/laguna-nina-encantada/" target="_blank" id="attraction-2" data-i18n="attraction-2">Laguna de la Niña Encantada</a></li>
    <li><a href="https://www.laslenas.com/" target="_blank" id="attraction-3" data-i18n="attraction-3">Valle de Las Leñas</a></li>
    <li><a href="https://www.malargue.tur.ar/dino-park/" target="_blank" id="attraction-4" data-i18n="attraction-4">Dino Park (Parque Huellas de Dinosaurios)</a></li>
    <li><a href="https://www.malargue.tur.ar/planetario/" target="_blank" id="attraction-5" data-i18n="attraction-5">Planetario Malargüe</a></li>
  </ul>

  <h2 data-i18n="recommended-activities-title">Actividades recomendadas</h2>
  <ul>
    <li data-i18n="rec-activity-0">Excursiones guiadas a la Caverna de las Brujas.</li>
    <li data-i18n="rec-activity-1">Safari fotográfico en La Payunia (si las edades y el interés lo permiten).</li>
    <li data-i18n="rec-activity-2">Trekking suave o paseos en bicicleta por el Valle de Las Leñas (fuera de temporada de nieve).</li>
    <li data-i18n="rec-activity-3">Visita al Observatorio Pierre Auger (con reserva).</li>
    <li data-i18n="rec-activity-4">Rafting o cabalgatas en los alrededores.</li>
    <li data-i18n="rec-activity-5">Exploración de la Laguna de la Niña Encantada y sus formaciones rocosas.</li>
  </ul>

  <h2 data-i18n="gastronomy-title">Gastronomía destacada</h2>
  <p data-i18n="gastronomy-intro">La gastronomía en Malargüe se enfoca en platos patagónicos, carnes a la parrilla, chivito a la llama (plato típico de la zona) y productos regionales. Las opciones para dietas especiales pueden ser más limitadas, por lo que se recomienda preguntar.</p>
  <h3 data-i18n="restaurants-title">Restaurantes recomendados</h3>
  <table>
    <thead>
      <tr>
        <th data-i18n="table-restaurant">Restaurante</th>
        <th data-i18n="table-type">Tipo</th>
        <th data-i18n="table-gluten-free">Sin Gluten</th>
        <th data-i18n="table-sugar-free">Sin Azúcar</th>
      </tr>
    </thead>
    <tbody>
      <tr>
        <td><a href="https://www.tripadvisor.com.ar/Restaurant_Review-g303403-d10103700-Reviews-La_Posta_de_Jamon-Malargue_Province_of_Mendoza_Cuyo.html" target="_blank">La Posta de Jamón</a></td>
        <td data-i18n="restaurant-type-0">Parrilla / Chivito a la llama</td>
        <td data-i18n="yes-symbol">✔️</td>
        <td data-i18n="no-symbol">❌</td>
      </tr>
      <tr>
        <td><a href="https://www.tripadvisor.com.ar/Restaurant_Review-g303403-d10103700-Reviews-El_Viejo_Retiro-Malargue_Province_of_Mendoza_Cuyo.html" target="_blank">El Viejo Retiro</a></td>
        <td data-i18n="restaurant-type-1">Comida casera / Regional</td>
        <td data-i18n="yes-symbol">✔️</td>
        <td data-i18n="yes-symbol">✔️</td>
      </tr>
      <tr>
        <td><a href="https://www.tripadvisor.com.ar/Restaurant_Review-g303403-d10103700-Reviews-Pizzeria_La_Avenida-Malargue_Province_of_Mendoza_Cuyo.html" target="_blank">Pizzería La Avenida</a></td>
        <td data-i18n="restaurant-type-2">Pizzería tradicional</td>
        <td data-i18n="no-symbol">❌</td>
        <td data-i18n="no-symbol">❌</td>
      </tr>
    </tbody>
  </table>
  <h3 data-i18n="cafes-title">Confiterías y cafés</h3>
  <table>
    <thead>
      <tr>
        <th data-i18n="table-cafe">Confitería</th>
        <th data-i18n="table-type">Tipo</th>
        <th data-i18n="table-gluten-free">Sin Gluten</th>
        <th data-i18n="table-sugar-free">Sin Azúcar</th>
      </tr>
    </thead>
    <tbody>
      <tr>
        <td data-i18n="cafe-type-0">(Opciones limitadas)</td>
        <td data-i18n="cafe-type-1">Cafés locales / panaderías</td>
        <td data-i18n="no-symbol">❌</td>
        <td data-i18n="no-symbol">❌</td>
      </tr>
      <tr>
        <td data-i18n="cafe-type-2">Supermercados</td>
        <td data-i18n="cafe-type-3">Para abastecerse</td>
        <td data-i18n="yes-symbol">✔️</td>
        <td data-i18n="yes-symbol">✔️</td>
      </tr>
    </tbody>
  </table>

  <div class="ai-section">
    <h2 data-i18n="ai-menu-title">Generador de Menú Saludable ✨</h2>
    <p data-i18n="ai-menu-description">Obtén sugerencias de menú para un día completo (desayuno, almuerzo, cena) adaptadas para dietas bajas en carbohidratos, aptas para diabéticos y, si es posible, sin gluten, inspiradas en la gastronomía de Malargüe.</p>
    <button class="ai-button" id="generate-menu-btn" data-i18n="generate-menu-button">Generar Menú</button>
    <div class="ai-loading" id="ai-menu-loading-indicator" style="display:none;" data-i18n="ai-loading">Generando menú...</div>
    <div class="ai-response" id="ai-menu-response"></div>
  </div>

  <div class="ai-section">
    <h2 data-i18n="ai-accommodation-title">Sugerencias de Alojamiento con IA 🏨</h2>
    <p data-i18n="ai-accommodation-description">Obtén recomendaciones de alojamiento en Malargüe, considerando opciones familiares, seguras y bien ubicadas.</p>
    <button class="ai-button" id="generate-accommodation-btn" data-i18n="generate-accommodation-button">Generar Sugerencias</button>
    <div class="ai-loading" id="ai-accommodation-loading-indicator" style="display:none;" data-i18n="ai-loading">Generando sugerencias...</div>
    <div class="ai-response" id="ai-accommodation-response"></div>
  </div>

  <div class="ai-section">
    <h2 data-i18n="ai-family-tips-title">Consejos Adicionales para Familias con IA 👨‍👩‍👧‍👦</h2>
    <p data-i18n="ai-family-tips-description">Recibe consejos personalizados para disfrutar Malargüe en familia, incluyendo actividades, seguridad y logística.</p>
    <button class="ai-button" id="generate-family-tips-btn" data-i18n="generate-family-tips-button">Generar Consejos</button>
    <div class="ai-loading" id="ai-family-tips-loading-indicator" style="display:none;" data-i18n="ai-loading">Generando consejos...</div>
    <div class="ai-response" id="ai-family-tips-response"></div>
  </div>

  <div class="ai-section">
    <h2 data-i18n="ai-budget-title">Análisis de Presupuesto con IA 💰</h2>
    <p data-i18n="ai-budget-description">Obtén un análisis y desglose del presupuesto orientativo para tu estadía en Malargüe, con posibles optimizaciones.</p>
    <button class="ai-button" id="generate-budget-btn" data-i18n="generate-budget-button">Analizar Presupuesto</button>
    <div class="ai-loading" id="ai-budget-loading-indicator" style="display:none;" data-i18n="ai-loading">Analizando presupuesto...</div>
    <div class="ai-response" id="ai-budget-response"></div>
  </div>

  <h2 data-i18n="accommodation-title">Alojamiento (ejemplos)</h2>
  <ul>
    <li data-i18n="accommodation-0">Hotel Malargüe</li>
    <li data-i18n="accommodation-1">Complejo Los Molles (cerca de Las Leñas)</li>
    <li data-i18n="accommodation-2">Cabañas y hospedajes rurales.</li>
    <li data-i18n="accommodation-3">Airbnb en el centro de Malargüe.</li>
  </ul>

  <h2 data-i18n="coordinates-title">Coordenadas aproximadas</h2>
  <p data-i18n="coordinates-text">35° 28' S 69° 35' O</p>

  <h2 data-i18n="events-agenda-title">Agenda de eventos</h2>
  <ul>
    <li data-i18n="event-0">**(Consultar agenda local)**: Fiesta Nacional del Chivo (Enero).</li>
    <li data-i18n="event-1">**(Consultar agenda local)**: Eventos relacionados con astronomía o geología.</li>
    <li><a href="../docs/agenda/ariflier1970@gmail.com.ical.zip" target="_blank" data-i18n="download-agenda">Descargar agenda completa en formato iCal (.zip)</a></li>
  </ul>

  <h2 data-i18n="family-tips-title">Consejos para familias</h2>
  <ul>
    <li data-i18n="family-tip-0">Para explorar los atractivos naturales, es casi indispensable contar con un vehículo propio o contratar excursiones organizadas.</li>
    <li data-i18n="family-tip-1">La Caverna de las Brujas puede ser un poco exigente físicamente para niños muy pequeños o personas con movilidad reducida.</li>
    <li data-i18n="family-tip-2">Lleven abundante agua y ropa adecuada para cambios bruscos de temperatura, especialmente si visitan áreas de alta montaña o desierto.</li>
    <li data-i18n="family-tip-3">La señal de celular puede ser limitada fuera de la ciudad.</li>
    <li data-i18n="family-tip-4">Respeten las indicaciones de los guías en las reservas naturales.</li>
  </ul>

  <h2 data-i18n="budget-title">Presupuesto orientativo</h2>
  <table>
    <thead>
      <tr>
        <th data-i18n="budget-concept">Concepto</th>
        <th data-i18n="budget-price">Precio estimado (USD)</th>
      </tr>
    </thead>
    <tbody>
      <tr>
        <td data-i18n="budget-concept-0">Alojamiento (noche, familia)</td>
        <td data-i18n="budget-price-0">40–100</td>
      </tr>
      <tr>
        <td data-i18n="budget-concept-1">Comida (por día, familia)</td>
        <td data-i18n="budget-price-1">25–60</td>
      </tr>
      <tr>
        <td data-i18n="budget-concept-2">Transporte local (por día)</td>
        <td data-i18n="budget-price-2">5–15 (excl. alquiler auto)</td>
      </tr>
      <tr>
        <td data-i18n="budget-concept-3">Actividades y tours (por día)</td>
        <td data-i18n="budget-price-3">20–60 (excl. Payunia)</td>
      </tr>
      <tr>
        <td data-i18n="budget-concept-4">Entradas museos/atracciones</td>
        <td data-i18n="budget-price-4">0–15</td>
      </tr>
    </tbody>
  </table>

  <h2 data-i18n="cultural-tips-title">Tips culturales</h2>
  <ul>
    <li data-i18n="cultural-tip-0">Malargüe es una región más rural y con una fuerte identidad de campo.</li>
    <li data-i18n="cultural-tip-1">La vida nocturna es limitada; el foco está en la naturaleza y el descanso.</li>
    <li data-i18n="cultural-tip-2">El chivito a la llama es una tradición culinaria muy arraigada y un imperdible local.</li>
    <li data-i18n="cultural-tip-3">La amabilidad y la hospitalidad de su gente son características destacadas.</li>
  </ul>

  <h2 id="map-title" data-i18n="map-title">Mapa de Malargüe</h2>
  <iframe src="https://www.openstreetmap.org/export/embed.html?bbox=-69.75%2C-35.6%2C-69.45%2C-35.3&amp;layer=mapnik" width="100%" height="350"></iframe>
  <br><small><a href="https://www.openstreetmap.org/#map=12/-35.478/-69.585" target="_blank" id="see-bigger-map" data-i18n="see-bigger-map">Ver mapa más grande</a></small>

  <script>
    // Diccionario de traducciones español ↔ hebreo
    const translations = {
      es: {
        "page-title": "Malargüe | Viaje Familiar a Argentina",
        "idioma": "Idioma:",
        "moneda": "Moneda:",
        "city-title": "Malargüe",
        "welcome-text": "Malargüe es una ciudad en el sur de Mendoza, conocida por sus paisajes volcánicos, formaciones geológicas únicas y aventuras en la naturaleza. Es la puerta de entrada a atractivos como la Caverna de las Brujas y la Laguna de la Niña Encantada.",
        "foto-caption": "Paisaje volcánico de Malargüe",
        "dates-duration-title": "Fechas y duración",
        "stay-duration": "**Estadía**: 13/10 al 16/10 (4 días)",
        "how-to-arrive": "**Cómo llegar**: Bus desde Mendoza / Auto de alquiler",
        "main-attractions-title": "Lugares imperdibles",
        "attraction-0": "Caverna de las Brujas",
        "attraction-1": "La Payunia",
        "attraction-2": "Laguna de la Niña Encantada",
        "attraction-3": "Valle de Las Leñas",
        "attraction-4": "Dino Park (Parque Huellas de Dinosaurios)",
        "attraction-5": "Planetario Malargüe",
        "recommended-activities-title": "Actividades recomendadas",
        "rec-activity-0": "Excursiones guiadas a la Caverna de las Brujas.",
        "rec-activity-1": "Safari fotográfico en La Payunia (si las edades y el interés lo permiten).",
        "rec-activity-2": "Trekking suave o paseos en bicicleta por el Valle de Las Leñas (fuera de temporada de nieve).",
        "rec-activity-3": "Visita al Observatorio Pierre Auger (con reserva).",
        "rec-activity-4": "Rafting o cabalgatas en los alrededores.",
        "rec-activity-5": "Exploración de la Laguna de la Niña Encantada y sus formaciones rocosas.",
        "gastronomy-title": "Gastronomía destacada",
        "gastronomy-intro": "La gastronomía en Malargüe se enfoca en platos patagónicos, carnes a la parrilla, chivito a la llama (plato típico de la zona) y productos regionales. Las opciones para dietas especiales pueden ser más limitadas, por lo que se recomienda preguntar.",
        "restaurants-title": "Restaurantes recomendados",
        "table-restaurant": "Restaurante",
        "table-type": "Tipo",
        "table-gluten-free": "Sin Gluten",
        "table-sugar-free": "Sin Azúcar",
        "restaurant-type-0": "Parrilla / Chivito a la llama",
        "restaurant-type-1": "Comida casera / Regional",
        "restaurant-type-2": "Pizzería tradicional",
        "cafes-title": "Confiterías y cafés",
        "table-cafe": "Confitería",
        "cafe-type-0": "(Opciones limitadas)",
        "cafe-type-1": "Cafés locales / panaderías",
        "cafe-type-2": "Supermercados",
        "cafe-type-3": "Para abastecerse",
        "yes-symbol": "✔️",
        "no-symbol": "❌",
        "ai-menu-title": "Generador de Menú Saludable ✨",
        "ai-menu-description": "Obtén sugerencias de menú para un día completo (desayuno, almuerzo, cena) adaptadas para dietas bajas en carbohidratos, aptas para diabéticos y, si es posible, sin gluten, inspiradas en la gastronomía de Malargüe.",
        "generate-menu-button": "Generar Menú",
        "ai-loading": "Generando menú...",
        "ai-error": "Error al generar el menú. Por favor, inténtalo de nuevo más tarde.",
        "ai-menu-prompt": "Genera un plan de menú de un día (desayuno, almuerzo, cena) para una familia que visita Malargüe, Argentina. Las opciones deben ser aptas para diabéticos, bajas en carbohidratos y, si es posible, sin gluten. Incluye ejemplos de platos típicos de Malargüe (chivito, etc.) adaptados a estas restricciones dietéticas. Formatea la respuesta en párrafos claros para cada comida.",
        "ai-accommodation-title": "Sugerencias de Alojamiento con IA 🏨",
        "ai-accommodation-description": "Obtén recomendaciones de alojamiento en Malargüe, considerando opciones familiares, seguras y bien ubicadas.",
        "generate-accommodation-button": "Generar Sugerencias",
        "ai-accommodation-prompt": "Genera 3-5 sugerencias de alojamiento en Malargüe, Argentina, ideales para una familia con 2 hijos. Considera opciones seguras, bien ubicadas y con servicios adecuados para familias. Incluye diferentes tipos de alojamiento como hoteles, complejos turísticos o cabañas. Formatea la respuesta con viñetas.",
        "ai-family-tips-title": "Consejos Adicionales para Familias con IA 👨‍👩‍👧‍👦",
        "ai-family-tips-description": "Recibe consejos personalizados para disfrutar Malargüe en familia, incluyendo actividades, seguridad y logística.",
        "generate-family-tips-button": "Generar Consejos",
        "ai-family-tips-prompt": "Proporciona 5 consejos prácticos y personalizados para una familia con niños que visita Malargüe, Argentina. Los consejos deben cubrir aspectos como actividades para niños, seguridad en la ciudad y en la naturaleza, opciones de transporte familiar, y cómo aprovechar al máximo la estadía. Formatea la respuesta con viñetas.",
        "ai-budget-title": "Análisis de Presupuesto con IA 💰",
        "ai-budget-description": "Obtén un análisis y desglose del presupuesto orientativo para tu estadía en Malargüe, con posibles optimizaciones.",
        "generate-budget-button": "Analizar Presupuesto",
        "ai-budget-prompt": "Analiza el siguiente presupuesto orientativo para una familia en Malargüe (USD): Alojamiento (noche): 40-100, Comida (día): 25-60, Transporte local (día): 5-15 (excl. alquiler auto), Actividades (día): 20-60 (excl. Payunia), Entradas: 0-15. Proporciona un desglose estimado por día y por categoría, y sugiere 2-3 formas de optimizar o ahorrar en este presupuesto sin sacrificar la experiencia familiar. Formatea la respuesta en párrafos.",
        "accommodation-title": "Alojamiento (ejemplos)",
        "accommodation-0": "Hotel Malargüe",
        "accommodation-1": "Complejo Los Molles (cerca de Las Leñas)",
        "accommodation-2": "Cabañas y hospedajes rurales.",
        "accommodation-3": "Airbnb en el centro de Malargüe.",
        "coordinates-title": "Coordenadas aproximadas",
        "coordinates-text": "35° 28' S 69° 35' O",
        "events-agenda-title": "Agenda de eventos",
        "event-0": "**(Consultar agenda local)**: Fiesta Nacional del Chivo (Enero).",
        "event-1": "**(Consultar agenda local)**: Eventos relacionados con astronomía o geología.",
        "download-agenda": "Descargar agenda completa en formato iCal (.zip)",
        "family-tips-title": "Consejos para familias",
        "family-tip-0": "Para explorar los atractivos naturales, es casi indispensable contar con un vehículo propio o contratar excursiones organizadas.",
        "family-tip-1": "La Caverna de las Brujas puede ser un poco exigente físicamente para niños muy pequeños o personas con movilidad reducida.",
        "family-tip-2": "Lleven abundante agua y ropa adecuada para cambios bruscos de temperatura, especialmente si visitan áreas de alta montaña o desierto.",
        "family-tip-3": "La señal de celular puede ser limitada fuera de la ciudad.",
        "family-tip-4": "Respeten las indicaciones de los guías en las reservas naturales.",
        "budget-title": "Presupuesto orientativo",
        "budget-concept": "Concepto",
        "budget-price": "Precio estimado (USD)",
        "budget-concept-0": "Alojamiento (noche, familia)",
        "budget-price-0": "40–100",
        "budget-concept-1": "Comida (por día, familia)",
        "budget-price-1": "25–60",
        "budget-concept-2": "Transporte local (por día)",
        "budget-price-2": "5–15 (excl. alquiler auto)",
        "budget-concept-3": "Actividades y tours (por día)",
        "budget-price-3": "20–60 (excl. Payunia)",
        "budget-concept-4": "Entradas museos/atracciones",
        "budget-price-4": "0–15",
        "cultural-tips-title": "Tips culturales",
        "cultural-tip-0": "מלארגואה הוא אזור כפרי יותר עם זהות שדה חזקה.",
        "cultural-tip-1": "חיי הלילה מוגבלים; הדגש הוא על הטבע והמנוחה.",
        "cultural-tip-2": "צ'יביטו א-לה-יאמה הוא מסורת קולינרית מושרשת מאוד ופריט חובה מקומי.",
        "cultural-tip-3": "אדיבותם ואירוחם של המקומיים בולטים.",
        "map-title": "מפת מלארגואה",
        "see-bigger-map": "לצפייה במפה גדולה יותר",
        "back-link": "⬅ חזרה למפת המסלול"
      }
    };

    // Tasas de cambio (se actualizan al cargar la página)
    let tasas = {
      ARS: 1,
      USD: 1000, // Valor de ejemplo, se actualizará
      ILS: 110   // Valor de ejemplo, se actualizará
    };
    // Símbolos de moneda
    const simbolos = {
      ARS: "$",
      USD: "US$",
      ILS: "₪"
    };

    let idiomaActual = 'es'; // Idioma predeterminado
    let monedaActual = 'ARS'; // Moneda predeterminada

    // Función para obtener tasas de cambio reales desde ExchangeRate-API
    function actualizarTasas(callback) {
      fetch('https://open.er-api.com/v6/latest/USD')
        .then(response => response.json())
        .then(data => {
          if (data && data.result === "success") {
            tasas.ARS = data.rates.ARS;
            tasas.USD = 1;
            tasas.ILS = data.rates.ILS;
          }
          if (typeof callback === "function") callback();
        })
        .catch(() => {
          // Si falla, sigue con los valores por defecto
          if (typeof callback === "function") callback();
        });
    }

    function translatePage(language) {
      idiomaActual = language; // Actualiza la variable global idiomaActual
      document.body.dir = (language === 'he') ? 'rtl' : 'ltr';
      document.title = translations[language]["page-title"];

      document.querySelectorAll('[data-i18n]').forEach(el => {
        const key = el.getAttribute('data-i18n');
        if (translations[language][key]) { // Asegurarse de que la clave exista
          if (key.includes('event-') || key.includes('stay-duration') || key.includes('how-to-arrive')) {
            el.innerHTML = translations[language][key];
          } else {
            el.textContent = translations[language][key];
          }
        }
      });
      // Actualiza el estado activo de los botones de idioma
      document.getElementById('btn-es').classList.toggle('active', language === 'es');
      document.getElementById('btn-he').classList.toggle('active', language === 'he');
      // Guarda la preferencia de idioma en localStorage
      localStorage.setItem('idiomaPreferido', language);
    }

    function cambiarMoneda(moneda) {
      monedaActual = moneda; // Actualiza la variable global monedaActual
      document.getElementById('btn-ars').classList.toggle('active', moneda === 'ARS');
      document.getElementById('btn-usd').classList.toggle('active', moneda === 'USD');
      document.getElementById('btn-ils').classList.toggle('active', moneda === 'ILS');
      // Guarda la preferencia de moneda en localStorage
      localStorage.setItem('monedaPreferida', moneda);
      // No hay tablas de precios dinámicas en esta página de ciudad, pero si se agregaran, se llamarían aquí.
    }

    // Función genérica para llamar a la API de Gemini
    async function callGeminiAPI(promptKey, responseDivId, buttonId, loadingIndicatorId) {
      const button = document.getElementById(buttonId);
      const loadingIndicator = document.getElementById(loadingIndicatorId);
      const responseDiv = document.getElementById(responseDivId);

      button.disabled = true;
      loadingIndicator.style.display = 'block';
      responseDiv.textContent = ''; // Limpiar respuesta anterior

      const currentLanguage = localStorage.getItem('idiomaPreferido') || 'es';
      // Asegurarse de que el prompt se obtiene correctamente del diccionario
      const promptText = translations[currentLanguage][promptKey];

      if (!promptText) {
        responseDiv.textContent = translations[currentLanguage]["ai-error"] + " (Prompt no encontrado)";
        console.error(`Error: Prompt con clave '${promptKey}' no encontrado para el idioma '${currentLanguage}'.`);
        button.disabled = false;
        loadingIndicator.style.display = 'none';
        return;
      }

      let chatHistory = [];
      chatHistory.push({ role: "user", parts: [{ text: promptText }] });

      const payload = {
        contents: chatHistory,
        generationConfig: {
            responseMimeType: "text/plain"
        }
      };

      const apiKey = ""; // La clave API se proporcionará en tiempo de ejecución por el entorno Canvas
      const apiUrl = `https://generativelanguage.googleapis.com/v1beta/models/gemini-2.0-flash:generateContent?key=${apiKey}`;

      try {
        const response = await fetch(apiUrl, {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify(payload)
        });

        const result = await response.json();

        if (result.candidates && result.candidates.length > 0 &&
            result.candidates[0].content && result.candidates[0].content.parts &&
            result.candidates[0].content.parts.length > 0) {
          const text = result.candidates[0].content.parts[0].text;
          responseDiv.textContent = text;
        } else {
          responseDiv.textContent = translations[currentLanguage]["ai-error"];
          console.error("Estructura de respuesta inesperada del LLM:", result);
        }
      } catch (error) {
        responseDiv.textContent = translations[currentLanguage]["ai-error"];
        console.error("Error al llamar a la API de Gemini:", error);
      } finally {
        button.disabled = false;
        loadingIndicator.style.display = 'none';
      }
    }

    // Inicialización de la página al cargar el DOM
    document.addEventListener('DOMContentLoaded', function() {
      // Carga las preferencias de idioma y moneda desde localStorage
      const idiomaGuardado = localStorage.getItem('idiomaPreferido');
      const monedaGuardada = localStorage.getItem('monedaPreferida');

      // Aplica el idioma guardado o 'es' por defecto
      translatePage(idiomaGuardado || 'es');
      // Aplica la moneda guardada o 'ARS' por defecto
      cambiarMoneda(monedaGuardada || 'ARS');

      // Asocia los eventos click a los botones de IA
      document.getElementById('generate-menu-btn').addEventListener('click', () =>
        callGeminiAPI('ai-menu-prompt', 'ai-menu-response', 'generate-menu-btn', 'ai-menu-loading-indicator')
      );
      document.getElementById('generate-accommodation-btn').addEventListener('click', () =>
        callGeminiAPI('ai-accommodation-prompt', 'ai-accommodation-response', 'generate-accommodation-btn', 'ai-accommodation-loading-indicator')
      );
      document.getElementById('generate-family-tips-btn').addEventListener('click', () =>
        callGeminiAPI('ai-family-tips-prompt', 'ai-family-tips-response', 'generate-family-tips-btn', 'ai-family-tips-loading-indicator')
      );
      document.getElementById('generate-budget-btn').addEventListener('click', () =>
        callGeminiAPI('ai-budget-prompt', 'ai-budget-response', 'generate-budget-btn', 'ai-budget-loading-indicator')
      );
    });
  </script>
</body>
</html>
